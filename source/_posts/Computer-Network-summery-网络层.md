---
title: Computer Network summery  网络层
date: 2021-06-20 20:01:53
tags: 
- Network
categories: 
- Notes
keywords:
description: some of my thinks
top_img: 
comments: 
cover: https://cdn.jsdelivr.net/gh/chen-boran/Picture_bed/img/202203151833189.jpg
toc:  
toc_number:
copyright:
mathjax:
katex:
---

# Computer network summery :网络层

## 一、功能和服务

### 1.1概述

- 路由器不运行应用层和运输层协议

- 功能：转发和路由选择

-  网络层只向上提供简单灵活的，无连接的，尽力而为的**数据报服务**

- 路由选择：网络层决定分组所采用的路径或路由；计算方法是**路由选择算法**( routing algorithm)

- 路由器都具有一张**转发表** (fOlwarding tahle) 

- 某些网络体系结构也要求在数据报在路径中流动之前建立连接

  ​	例如：ATM 、帧中继、 MPLS

### 1.2 交换机

某些分组交换机称为

链路层交换机(link-Iayer switches) 

其他分组交换机称为路由器( router) 



### 1.3 服务模型

定义了分组在发送与接收端系统之间的端到端运输特性

- 网络层提供的特定服务
  - 确保支付
  - 具有时延上界的确 保交付
  - 有序分组支付
  - 确保最小带宽
  - 确保最大时延抖动
  - 安全性服务
- 网络层提供尽力而为服务



### 1.4虚电路和数据报网络

- 与运输层类似，网络层也能够在两台主机之间提供无连接服务或连接服务

1. **虚电路网络**:仅在网络层提供连接服务的计算机网络

2. **数据报网络**:仅在网络层提供无连接服务的计算机网络
3. 几乎所有主要计算机网络体系中都不**同时**提供两种服务
4. 与运输层的**区别**：运输层服务在端系统中实现，网络层连接服务在端系统中，也在位于网络核心的路由器中实现
5. 虚电路网络和数据报网络是计算机网络的两种基本类型 作出转发时，使用了非常不同的信息。

- 虚电路网络

- 数据报网络

  - 端系统要发送分组—>就为该分组加上目的端系统的地

    址，--->将分组推进网络中  

    无需建立任何虚电路，路由器不维护任何虚电路的状态信息

    

  

## 二、路由转发

### 1、路由器：

- 结构

  

  ![image-20210528204542791](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20210528204542791.png)

  - 输入端口：与物理链路相连
  - 交换结构：网络路由器中的网络
  - 输出端口：存储和传输交换结构传出的分组
  - 路由选择处理器：执行路由选择协议

### 2、输入端口

- 输入端口的处理
  - ![image-20210528205032133](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20210528205032133.png)
  - 从链路接收分组，对分组进行处理，通过路由表查找某分组的输出端口，发送到交换结构。
  - 阻塞的分组在输入端口进行排队

### 3、交换结构

- 交换结构：核心部位

  - 三种交换技术：

    ![image-20210528205614574](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20210528205614574.png)

    - 内存交换

    - 总线交换

    - 互联网络交换

      &&&&&&&&&&&&&&&&&&

### 4、输出端口

- 输出端口
  - ![image-20210528205817371](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20210528205817371.png)
  - 选择和取出排队的分组进行传输，执行所需的链路层和物理层传输功能
- 排队（拥塞）
  - 输入线路速率，比输出速率大，路由器空间耗尽，后到达的分组会丢包

## 三、网际协议 IP

- TCP/IP 体系中最重要的协议之一

- 与IP配套使用的相关协议由IGMP、ARP、ICMP等
- 通过IP协议使不同的网络在逻辑层面互相连接（虚拟连接）
- 通过IP区分不同的网络，一个网络可以由多种异构网络构成
- 

因特网中的转发和编址

- ![image-20210528211114845](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20210528211114845.png)

### 1、数据报格式

（IPv4）

![image-20210528211224903](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20210528211224903.png)

|      字段名称      |                    作用                    |
| :----------------: | :----------------------------------------: |
|       版本号       |                 IPv4/IPv6                  |
|      首部长度      |                 一般20字节                 |
|      服务类型      |                  服务类型                  |
|     数据报长度     |               IP数据报总长度               |
| 标识、标志、片偏移 |            与ip分片有关的标示量            |
|        寿命        | 寿命 (Time-To- Live TTL)；避免路由选择环路 |
|        协议        |          指示IP在运输层依赖的协议          |
|     首部检验和     |  帮助路由器检测收到的 数据报中的比特错误   |
|     源和目的IP     |                 转发的地址                 |
|        选项        |      选项字段 首部扩展（超过20字节）       |
|      数据部分      |                 有效载荷)                  |

### 2、数据报分片

- 数据报不能超过链路层所能承受的最大网络层分组

- 数据报过大时，进行分组，分成的较小数据报叫做片
- 片在目的地端系统进行重新组装，而不是路由器（简便网络内核）
- 发送方为它发送的每个数据报的标识号加1；也就是同一数据报，不同的片 标志相同
- 分片之后转发的片中，最后一个片的标志比特被设为0 ，而所有其他片的标志比特被设为1，
- 偏移字段指定该片应放在初始 数据报的哪个位置



### 3、IP编址

- 网络IP编制涉及以下几个问题：
  - 子网划分
  - 分类的IP地址
  - 子网掩码

**3.1 IP地址分类**：

- a类地址：1~126
  127被lookupback（回环地址）占用–》测试tcp/ip协议的是否正常，任何一台计算机上都有这个地址，这个地址代表本机（127.0.0.1）
  网络+主机+主机+主机
  1.0.0.0/8 --》google --》2^24 = 16777216
  1.0.0.1 1.0.0.2
  2.0.0.0/8 -->Harvard
  3.0.0.0/8 -->ibm
  4.0.0.0/8 -->microsoft

- b类地址：128~191
  网络+网络+主机+主机
  网络的个数：2^14 = 16384
  每个网络里可以容纳的主机数=2^16 -2
  129.1.0.0/16

- c类地址：192~223
  网络+网络+网络+主机
  网络的个数：2^21 = 2097152
  每个网络里可以容纳的主机数=2^8 - 2 =254
  主机部分全为0代表网段
  主机部分全为1代表这个网段的广播地址

- d类：224~239拥有组播通信
- E类：240~255 保留给科学研究使用
  <!--公网上使用的ip地址是A,B,C类-->

- 私有地址
  - 满足企业用户在内部网络中使用的需求
  - 私有地址不能在Internet上使用
  - 私有地址包括3组
    A类：10.0.0.0~10.255.255.255
    B类：172.16.0.0~172.31.255.255
    C类：192.168.0.0~192.168.255.255


 **具体详解：**

~~~
 
1. A类IP地址
   1.1 网络号——占1个字节
   A类地址的网络号字段占1个字节，但前面的1位(0)已经固定，只剩下7位可以进行分配。即可指派的网络号是126个(即2^7-2)。
   网络号字段为全0的IP地址是个保留地址，意思是“本网络”。
   网络号为127(即01111111)保留作为本地软件环回测试(loopback test)本主机的进程之间的通信只用。
   若主机发送一个目的地址为环回地址(例如 127.0.0.1)的IP数据报，则本主机中的协议软件就处理数据报中的数据，而不会把数据报发送到任何网络。
   目的地址为环回地址的IP数据报永远不会出现在任何网络上，因为网络号为127的地址根本不是一个网络地址。。
   1.2 主机号——占3个字节
   A类地址的主机号占3个字节，因此每一个A类网络中的最大主机数是2^24-2，即16777214。
   全0的主机号字段表示该IP地址是“本主机”所连接到的单个网络地址(例如，一主机的IP地址为5.6.7.8，则该主机所在的网络地址就是5.0.0.0)。
   全1的主机号字段表示该IP地址是“所有的”，即该网络上的所有主机。
   注：IP地址空间共有2^32(即4294967296)个地址。整个A类地址空间共有2^31个地址，占有整个IP地址空间的50%。


2. B类IP地址
   2.1 网络号——占2个字节
   B类地址的网络号字段占2个字节，但前面的2位(1 0)已经固定，只剩下14位可以进行分配。
   B类网络地址128.0.0.0是不指派的，而可以指派的B类最小网络地址是128.1.0.0。因此B类地址可指派的网络数是2^14-1，即16383。
   2.2 主机号——占2个字节
   B类地址的每一个网络上的最大主机数是2^16-2，即65534，这里需要减2是因为要扣除全0和全1的主机号。
   注：整个B类地址空间共约2^30个地址，占有整个IP地址空间的25%。


3. C类IP地址
   3.1 网络号——占3个字节
   C类地址的网络号字段占3个字节，但前面的3位(1 1 0)已经固定，只剩下21位可以进行分配。

   C类网络地址192.0.0.0是不指派的，而可以指派的C类最小网络地址是192.0.1.0。因此B类地址可指派的网络数是2^21-1，即2097151。

   3.2 主机号——占1个字节
   C类地址的每一个网络上的最大主机数是2^8-2，即254，这里需要减2是因为要扣除全0和全1的主机号。
   注：整个C类地址空间共约2^29个地址，占有整个IP地址空间的12.5%。

一些特殊的网络地址：
一、0.0.0.0
严格说来，0.0.0.0已经不是一个真正意义上的IP地址了。它表示的是这样一个集合：所有不清楚的主机和目的网络。这里的“不清楚”是指在本机的路由表里没有特定条目指明如何到达。对本机来说，它就是一个“收容所”，所有不认识的“三无”人员，一律送进去。如果你在网络设置中设置了缺省网关，那么Windows系统会自动产生一个目的地址为0.0.0.0的缺省路由。
二、255.255.255.255
限制广播地址。对本机来说，这个地址指本网段内(同一广播域)的所有主机。如果翻译成人类的语言，应该是这样：“这个房间里的所有人都注意了！”这个地址不能被路由器转发。
三、127.0.0.1
本机地址，主要用于测试。用汉语表示，就是“我自己”。在Windows系统中，这个地址有一个别名“Localhost”。寻址这样一个地址，是不能把它发到网络接口的。除非出错，否则在传输介质上永远不应该出现目的地址为“127.0.0.1”的数据包。
四、224.0.0.1
组播地址，注意它和广播的区别。从224.0.0.0到239.255.255.255都是这样的地址。224.0.0.1特指所有主机，224.0.0.2特指所有路由器。这样的地址多用于一些特定的程序以及多媒体程序。如果你的主机开启了IRDP(Internet路由发现协议，使用组播功能)功能，那么你的主机路由表中应该有这样一条路由。
五、169.254.X.X
如果你的主机使用了DHCP功能自动获得一个IP地址，那么当你的DHCP服务器发生故障，或响应时间太长而超出了一个系统规定的时间，Wingdows系统会为你分配这样一个地址。如果你发现你的主机IP地址是一个诸如此类的地址，很不幸，十有八九是你的网络不能正常运行了。
六、10.X.X.X、172.16.X.X～172.31.X.X、192.168.X.X
私有地址，这些地址被大量用于企业内部网络中。一些宽带路由器，也往往使用192.168.1.1作为缺省地址。私有网络由于不与外部互连，因而可能使用随意的IP地址。保留这样的地址供其使用是为了避免以后接入公网时引起地址混乱。使用私有地址的私有网络在接入Internet时，要使用地址翻译(NAT)，将私有地址翻译成公用合法地址。在Internet上，这类地址是不能出现的。对一台网络上的主机来说，它可以正常接收的合法目的网络地址有三种：本机的IP地址、广播地址以及组播地址。
七，广播地址(Broadcast Address)
是专门用于同时向网络中（通常指同一子网）所有工作站进行发送的一个地址。在使用TCP/IP 协议的网络中，主机标识段host ID（简称主机 ID） 为全 1 的 IP 地址为广播地址，广播的分组传送给同一个子网的所有计算机。例如，对于10.1.1.0 （255.255.255.0 ）网段，其广播地址为10.1.1.255 （255 即为 2 进制的 11111111 ），当发出一个目的地址为10.1.1.255 的数据包时，它将被分发给该网段上的所有计算机。广播地址应用于网络内的所有主机。
八，网络地址
指的是互联网上的节点在网络中具有的逻辑地址，可对节点进行寻址。主机地址指的是IP地址右边部分用来标识主机本身的部分。


一个 IP地址的网络部分被称为网络号或者网络地址,主机可以与具有相同的网络号的设备直接通讯，在没有连接设备的情况下，即使共享相同的物理网段，网络号不同则无法进行通讯，IP 地址的网络地址使路由器可以将分组置于正确的网段上 。
~~~



**2.子网掩码：**
16 表示网络部分的长度 --》子网掩码也是32位
作用：标识ip地址里网络部分的长度
用来确定IP的网络地址
11111111.11111111.00000000.00000000

32个二进制位
对应IP地址的网络部分用1表示
对应IP地址的主机部分用0表示
IP地址和子网掩码作逻辑“与”运算得到网络地址

0和任何数相与都等于0
1和任何数相与都等于任何数本身

网段：就是网络部分的内容
192.168.0.4/24 -->192.168.0.0

A、B、C三类地址的默认子网掩码
A类：255.0.0.0
B类：255.255.0.0
C类：255.255.255.0

**3.子网划分：**


将一个大网络划分为许多的小网络（网络位向主机位借位）
子网划分的原因：

- 满足不同网络对IP地址的需求
- 实现网络的层次性
  



### 4、互联网控制报文协议 (ICMP)

- 主机和路由器用来彼此沟通网络层的信息，用来进行差错报告。

- ICMP报文是承载在ip 分组中，但是也被看做ip的一部分

- ICMP协议的功能主要是：

  - 1. 确认IP包是否成功到达目标地址
    2. 通知在发送过程中IP包被丢弃的原因

- ICMP只能搭配IPv4使用，如果是IPv6的情况下, 需要是用ICMPv6

- **ICMP的报文格式**
  ICMP报文包含在IP数据报中 。

  ​	一个ICMP报文包括IP报头（至少20字节）、ICMP报头（至少八字节）	和ICMP报文（属于ICMP报文的数据部分）**。当IP报头中的协议字段值	为1时，就说明这是一个ICMP报文。**ICMP报头如下图所示。
   ![img](https://img-blog.csdn.net/201805301801365?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM3OTY0MDcx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

  字段说明：

  - 类型	一字节，标识ICMP报文的类型，从类型值来看ICMP报文可以分为两大类。第一类是取值为1~127的差错报文，第2类是取值128以上的信息报文
  - 代码	占一字节，标识对应ICMP报文的代码。它与类型字段一起共同标识了ICMP报文的详细类型
  - 校验和	这是对包括ICMP报文数据部分在内的整个ICMP数据报的校验和，以检验报文在传输过程中是否出现了差错（其计算方法与在我们介绍IP报头中的校验和计算方法是一样的） 

- 

- ICMP报文分类：

  - 一类是通知出错原因 （差错报告报文）；

  - 一类是用于诊断查询（询问报文）

    ![image-20210704145410714](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20210704145410714.png)

- 众所周知的 ping 程序发送一个 ICMP 类型 编码 的报文到指定主机



 



### 5、IGMP网际组管理协议



### 6、arp地址解析协议

- 逆地址解析协议RARP（现在几乎已经不使用了）
- 具体功能是：由IP地址解析得到硬件地址（MAC）

1.要点

- 在主机的高速缓存ARP 缓存中存放一个IP到硬件地址的动态映射表
  - 通过响应分组和请求分组动态获取想要发送的IP的未知硬件地址
  - 响应分组是单播；请求分组是广播
  - 每一个地址映射信息都有生存时间

### 7、ipv6

![image-20210528213948939](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20210528213948939.png)

**概述**

- 解决ipv4地址不足的问题

- 报文结构

  |   字段名称   |                  作用                   |
  | :----------: | :-------------------------------------: |
  |     版本     | IPv4/IPv6                         4比特 |
  |    流标签    |     于标识一条数据报的流    20比特      |
  |   流量类型   |      与TOS 字段的含义相似   8比特       |
  | 有效负载长度 |      IP首部后数据字节数量  16比特       |
  |  下一个首部  |     标识数据包交付对象（TCP/UDP ）      |
  |    跳限制    |       与TTL类似  避免路由选择环路       |
  |     协议     |        指示IP在运输层依赖的协议         |
  |  首部检验和  | 帮助路由器检测收到的 数据报中的比特错误 |
  |    源地址    |                 128比特                 |
  |   目的地址   |                 128比特                 |
  |   数据部分   |                有效载荷)                |

- IPv6首部40字节

**相对ipv4特点（不同）：**

- 不允许在中间路由器上进行分片与重新组装，只能在源与目的地上执行----------没有了分片标志
- 没有首部检验和字段，检验在运输层和数据链路层中完成
- 没有选项字段，删除选项字段使得 IP 首部成为定长的 40 字节
- 地址容量扩大了
- 拥有流标签和优先级





## 四、路由选择算法

主机通常直接与一台路由器相连接，该路由器即为该主机的默认路由器 (default router) , 又称为该主机的第一跳路由器 (first- hop router）

源主机的默认路由器称作源路由器( source 川出r) ，把目的主机的默认路由器称作目的路由器 (destination router)

一个分组从源主机到目的主机的路由选择的较好 方法即路由选择算法

在两个路由之间根据链路开销，存在一条或者多条最低开销路径。

最低开销路径也就是最短路径———————最短路径算法SPF；

**路由控制**

- 每路由控制。

  每台路由器中运行一种路由选择算法的情况，每台路由器中都包含转发和路由选择功能。每台路由器有一个路由选择组件，用于与其他路由器中的路由选择组件通信，以计算其转发表的值。这种每路由器控制的方法在因特网中已经使用了几十年。

  OSPF和BGP协议都是基于这种每路由器的方法进行控制的。

- 逻辑集中式控制。

  逻辑集中式控制器计算并分发转发表以供每台路由器使用的情况。通用的“匹配加动作”抽象允许执行传统的IP转发以及其他功能(负载共享、防火墙功能、NAT)的丰富集合，而这些功能先前是在单独的中间盒中实现的。

  SDN采用了逻辑集中控制器的概念，而这种方法在生产部署中得到了越来越多的应用。







#### 1.路由选择算法

**分类：**

- `全局式路由选择算法` (globaJ routing aJgorithm) 

  ：用完整的、全局性的网络知识计算从源到目的地之间的最低开销路径，即 以所有结点之间的连通

  性及所有链路的费用为输入

  例：链路状态算法  LS  

  ​       适应每路由和逻辑集中控制：路由计算可以在集中式路由选择器 开门中，也可以在每台路由器的路优选择组件

​		`分散式路由选择算法**` (dece t.ralized routing aJgorithm)

​				以迭代、分布式的方式计算最低开销路径 ，没有结点拥有关于所有网络链路费用的完整信息，				而每个结点仅有与其直接相连链路的费用知识即可开始工作

​		例：距离向量算法 DV   

​				天然适应逻辑集中式控制

- `静态路由选择算法` (SlaLÌc rouling aJgorithm)：**手工配置、路由更新慢、优先级高

  简单，开销小，但不能及时适应网络状态的变化，适用于小型网络。

  

  `动态路由选择算法`(dynamic rouling aJ gorithm)**：路由更新快（定期更新、及时响应链路费用或网络拓扑变化）

  能较好地适应网络状态的变化，实现较为复杂，适用于大型网络。

  容易受到路优选择循环、路由震荡的影响

- `负载敏感算法` load-sensiLÌve aJ gorithm)

  ：链路开销动态变化，反映当前链路底层链路的拥塞水平

  `负载迟钝算法`(load-insensitive) 

  当今的路由选择算法都是负载迟钝的。

**常见算法：**

- 电路交换路由选择算 (circuiL- swiLched routing algorith m)
- 距离向量(Distance- Vector, DV) 算法
  - 路由器周期性地向其相邻路由器广播自己知道的路由信息，用以通知相邻路由器自己可以到达的网络以及到达该网络的距离。相邻路由器可以根据收到的路由信息修改和刷新自己的路由表。
  - 优点：算法简单、易于实现。
  - 缺点：慢收敛问题，路由器的路径变化需要像波浪一样从相邻路由器传播出去，过程缓慢。

- 链路状态广播 (link state broadcast) 算法 
  - 也叫最短路径优先(shortest path first SPF)算法，它的主要做法如下：
    - 首先由路由器向相邻路由器发送查询报文，测试和它相邻路由器的链路状态。如果可以收到相邻路由器发回的响应，则说明该相邻路由器和这个路由器之间可以正常通信；
    - 在收到该路由器和其他相邻路由器的链路状态后，还向系统中所有参加最短路径优先算法的路由器发送链路状态报文；
    - 各路由器收到其他路由器发来的链路状态报文后，根据报文中的数据刷新本路由器所保存的网络拓扑结构图。如果链路发生变化，路由器将启用Dijkstra算法生成新的最短路径优先数，并刷新本地路由表；

***分层次的路由选择协议：***

因特网采用的路由选择协议主要是**自适应的、动态的、分布式的、分层次的**路由选择协议。

***自治系统（autonomous system,AS）***

 就是几个路由器组成了一个小团体，小团体内部使用专用的协议进行通信，而小团体和小团体之间也使用专用的协议进行通信。

目前的因特网中，ISP就是一个自治系统。



## 五、路由选择协议

计算出用于在网络中转发分组的转发表

两种 AS 内部路由选择协议 (RIP/OSPF) 和一种 AS 间路由选择协议 (BGP)

### 1、AS 内部路由选择协议 

 

#### 1.1 路由信息协议 RIP

 (Routing Information Protocol)

✅ 它是一种分布式的、基于距离向量的路由选择协议。
✅ 它要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录。
**关于距离的定义：**

从一个路由器到直接连接的网络的距离定义为 1。
从一个路由器到非直接连接的网络的距离定义为所经过的路由器数加 1。
“距离” 也称为 “跳数”(hop count)，因为每经过一个路由器，跳数就加 1。
这里的“距离”实际上指的是“最短距离”。
RIP 认为一个好的路由就是它通过的路由器的数目少，即“距离短”。

RIP 允许一条路径最多只能包含 15 个路由器。

这意味着 RIP 只会选择一个具有最少路由器的路由（即最短路由），哪怕还存在另一条高速(低时延)但路由器较多的路由。

**RIP 协议的三个特点:**

- 仅和相邻路由器交换信息。

- 交换的信息是当前本路由器所知道的全部信息，即自己的路由表。

- 按固定的时间间隔交换路由信息，例如，每隔 30 秒。

  

  **AS（自治系统）之内的路由器如何建立路由表？**

路由器在刚刚开始工作时，只知道到直接连接的网络的距离（此距离定义为1）。它的路由表是空的。以后，每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息。
经过若干次更新后，所有的路由器最终都会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器的地址。
RIP 协议的收敛 (convergence) 过程较快。“收敛”就是在自治系统中所有的结点都得到正确的路由选择信息的过程。

 **RIP2的报文格式**

![img](https://img-blog.csdnimg.cn/20200414151233228.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk0MTM2NA==,size_16,color_FFFFFF,t_70)

RIP2 报文由首部和路由部分组成。

- RIP2 报文中的路由部分由若干个路由信息组成。
- 地址族标识符（又称为地址类别）字段用来标志所使用的地址协议。
- 路由标记填入自治系统的号码，这是考虑使 RIP 有可能收到本自治系统以外的路由选择信息。
- 再后面指出某个网络地址、该网络的子网掩码、下一跳路由器地址以及到此网络的距离。

一个 RIP 报文最多可包括 25 个路由，因而 RIP 报文的最大长度是4 + 20 × 25 = 504 4+20\times25=5044+20×25=504字节。如超过，必须再用一个 RIP 报文来传送。


#### 1.2 开放最短路径优先 OSPF

- OSPF (Open Shortest Path First) 是为克服 RIP 的缺点在`1989`年开发出来的。

- 使用了 Dijkstra 提出的最短路径算法 SPF

**区域**

OSPF 将一个自治系统再划分为若干个更小的范围，叫作`区域`。

每一个区域都有一个 32 位的区域标识符（用点分十进制表示）。

![img](https://img-blog.csdnimg.cn/20200414174248189.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk0MTM2NA==,size_16,color_FFFFFF,t_70)

**OSPF 使用 IP 数据报传送：**

- ✅ OSPF 不用 UDP 而是直接用 IP 数据报传送。
- ✅ OSPF 构成的数据报很短。好处是可以不必将长的数据报分片传送。
- ✅ 支持可变长度的子网划分和无分类编址 CIDR。

**OSPF 分组**

![img](https://img-blog.csdnimg.cn/20200414174524743.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk0MTM2NA==,size_16,color_FFFFFF,t_70)

五种分组类型

1️⃣ 类型1：问候 (Hello) 分组。
2️⃣ 类型2：数据库描述 (Database Description) 分组。
3️⃣ 类型3：链路状态请求 (Link State Request) 分组。
4️⃣ 类型4：链路状态更新 (Link State Update) 分组，用洪泛法对全网更新链路状态。
5️⃣ 类型5：链路状态确认 (Link State Acknowledgment) 分组。

### 2、AS 间路由选择协议 

 **(边界网关协议 BGP）**

- BGP 是不同自治系统的路由器之间交换路由信息的协议

- 要先建立 TCP 连接，然后在此连接上交换 BGP 报文以建立 BGP 会话(session)，利用 BGP 会话交换路由信息。

![img](https://img-blog.csdnimg.cn/20200414174933546.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk0MTM2NA==,size_16,color_FFFFFF,t_70)

**BGP-4 共使用四种报文** 

1.  打开 (OPEN) 报文：用来与相邻的另一个BGP发言人建立关系。
2.  更新 (UPDATE) 报文：用来发送某一路由的信息，以及列出要撤消的多条路由。
3.  保活 (KEEPALIVE) 报文：用来确认打开报文和周期性地证实邻站关系。
4.  通知 (NOTIFICATION) 报文：用来发送检测到的差错。

![img](https://img-blog.csdnimg.cn/20200414175219726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk0MTM2NA==,size_16,color_FFFFFF,t_70)

## 六、简单网络管理协议（SNMP）



基于T C P / I P的网络管理包含两个部分：网络管理站（也叫管理进程， m a n a g e r）和被管的网络单元（也叫被管设备）。被管设备端和管理相关的软件叫做代理程序( a g e n t )或代理进程。

管理进程和代理进程之间的通信可以有两种方式。一种是管理进程向代理进程发出请求，询问一个具体的参数值（例如：你产生了多少个不可达的 I C M P端口？）。另外一种方式是代理进程主动向管理进程报告有某些重要的事件发生。

基于T C P / I P的网络管理包含3个组成部分：

1)  一个管理信息库M I B（Management Information Base）。管理信息库包含所有代理进程的所有可被查询和修改的参数。

2)  关于M I B的一套公用的结构和表示符号。叫做管理信息结构SMI（Structure of Management Information）。

3)  管理进程和代理进程之间的通信协议，叫做简单网络管理协议 S N M P（Simple Network Management Protocol）。

协议
关于管理进程和代理进程之间的交互信息， S N M P定义了5种报文：

1)  get - r e q u e s t操作：从代理进程处提取一个或多个参数值。

2)  get - n e x t - r e q u e s t操作：从代理进程处提取一个或多个参数的下一个参数值

3)  set - r e q u e s t操作：设置代理进程的一个或多个参数值。

4)  get - r e s p o n s e操作：返回的一个或多个参数值。这个操作是由代理进程发出的。它是前面3中操作的响应操作。

5) t r a p 操作：代理进程主动发出的报文，通知管理进程有某些事情发生。

前面的3个操作是由管理进程向代理进程发出的。后面两个是代理进程发给管理进程的。


管理信息结构
SNMP中，数据类型不多，只有INTEGER，OCTER STRING，IPAddress等

对象标识符
对象标识是一种数据类型，它指明一种“授权”命名的对象。“授权”的意思就是这些标识不是随便分配的，它是由一些权威机构进行管理和分配的。

对象标识是一个整数序列，以点（“.”）分隔。这些整数构成一个树型结构，类似于 D N S或U n i x的文件系统

 管理信息库介绍
所谓管理信息库，或者M I B，就是所有代理进程包含的、并且能够被管理进程进行查询和设置的信息的集合。

M I B组：s y s t e m（系统标识）、i f（接口）、a t（地址转换）、i p、i c m p和t c p。

s y s t e m组非常简单，它包含7个简单变量

interface组只定义了一个简单变量，那就是系统的接口数量

i p组定义了很多简单变量和3个表格变量

i c m p组包含4个普通计数器变量（ I C M P报文的输出和输入数量以及 I C M P差错报文的输入和输出数量）和2 2个其他I C M P报文数量的计数器：11个是输出计数器，另外11个是输入计数器。

t c p组中的简单变量几乎都和T C P状态有关。

## 七、SDN 控制平面



