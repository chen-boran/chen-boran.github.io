---
title: 多线程
date: 2021-10-28 21:21:13
tags:
---

# 多线程

线程涉及以下几点：

- 线程的同步
- 线程的生命周期
- 线程的通信
- 线程的创建（4）
- 线程安全与解决（3）

### 基本概念

程序：

进程：正在运行的程序，程序执行的一次执行过程

- 生命周期：产生，执行消亡的过程。

线程 ：进程进一步细化。

- 进程可以含有多个线程
- 多个线程共享一个进程中的方法区和堆
- 每个线程各自一个程序计数器和虚拟机栈
- 一个进程中的多个线程共享相同的内存单元/内存地址空间
- 从同一堆中分配对象，可以访问相同的变量和对象。使得线程间通信更简便、高效。
- 多个线程操作共享的系统资源可能就会带来安全的隐患。



#### 并行与并发

并行：多个cpu执行多个任务

并发：一个CPU执行多个任务（时间片）


### 创建多线程

  使用了：java.lang.Thread类

- 步骤：
  - 定义子类继承Thread类。
  - 子类中重写Thread类中的run方法
  - 创建Thread子类对象，即创建了线程对象。
  - 调用线程对象start方法：启动线程，调用run方法



- start（）：启动当前线程；调用当前的run()方法。

  ​				必须使用start开启一个新的线程，不能直接调用run()

- 建立多个线程需要的重新创建线程的对象，不能让已经start的线程start

#### 常用方法

- **void start():** 启动线程，并执行对象的run()方法

- **run():** 线程在被调度时执行的操作

- **String getName():** 返回线程的名称

- **void setName(String name)**:设置该线程名称

- **static Thread currentThread():** 返回当前线程。在Thread子类中就

是this，通常用于主线程和Runnable实现类



- **static void yield()***线程让步

  暂停当前正在执行的线程，把执行机会让给优先级相同或更高的线程，若队列中没有同优先级的线程，忽略此方法。

- **join()** **：**当某个程序执行流中调用其他线程的 join() 方法时，调用线程将

  被阻塞，直到 join() 方法加入的 join 线程执行完为止低优先级的线程也可以获得执行

- **static void sleep(long millis)****：**(指定时间:毫秒) 

  令当前活动线程在指定时间段内放弃对CPU控制,使其他线程有机会被执行,时间到后

  重排队。

  抛出InterruptedException异常

- **stop():** 强制线程生命期结束，不推荐使用

- **boolean isAlive()****：**返回boolean，判断线程是否还活着

#### 线程优先级

**抢占式**：高优先级的线程抢占CPU

等级:*MAX_PRIORITY*：1~10

使用方法：

- **getPriority()** **：**返回线程优先值

- **setPriority(int newPriority)** **：**改变线程的优先级

优先级的设置要在start()之前。

#### 第二种创建方式：

 步骤：

1) 定义子类，实现Runnable接口。

2) 子类中重写Runnable接口中的run方法。

3) 通过Thread类含参构造器创建线程对象。

4) 将Runnable接口的子类对象作为实际参数传递给Thread类的构造器中。

5) 调用Thread类的start方法：开启线程，调用Runnable子类接口的run方法。

 

### 生命周期

定义在Thread.state中

- **新建：** 当一个Thread类或其子类的对象被声明并创建时，新生的线程对象处于新建

状态

- **就绪：**处于新建状态的线程被start()后，将进入线程队列等待CPU时间片，此时它已

具备了运行的条件，只是没分配到CPU资源

- **运行：**当就绪的线程被调度并获得CPU资源时,便进入运行状态， run()方法定义了线

程的操作和功能

- **阻塞：**在某种特殊情况下，被人为挂起或执行输入输出操作时，让出 CPU 并临时中

止自己的执行，进入阻塞状态

- **死亡：**线程完成了它的全部工作或线程被提前强制性地中止或出现异常导致结束

![image-20210928163052596](https://raw.githubusercontent.com/chen-boran/Picture_bed/main/img/image-20210928163052596.png)

#### 安全问题

- 操作共享数据，即为需要被同步的代码 会产生线程安全问题

使用同步方式解决线程安全问题



#### 线程通信
