<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Mybatis | boranの小さな巣</title><meta name="author" content="chen-boran"><meta name="copyright" content="chen-boran"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.MyBatis简介MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO  官方文档 http:&#x2F;&#x2F;www.mybatis.org&#x2F;mybatis-3&#x2F;getting-started.htm">
<meta property="og:type" content="article">
<meta property="og:title" content="Mybatis">
<meta property="og:url" content="http://example.com/2021/10/28/Mybatis/index.html">
<meta property="og:site_name" content="boranの小さな巣">
<meta property="og:description" content="1.MyBatis简介MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO  官方文档 http:&#x2F;&#x2F;www.mybatis.org&#x2F;mybatis-3&#x2F;getting-started.htm">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ae01.alicdn.com/kf/U36fdd5af2ca24a5c8cf8bd7e3195e13bx.jpg">
<meta property="article:published_time" content="2021-10-28T13:47:32.000Z">
<meta property="article:modified_time" content="2021-10-28T13:48:03.788Z">
<meta property="article:author" content="chen-boran">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ae01.alicdn.com/kf/U36fdd5af2ca24a5c8cf8bd7e3195e13bx.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="http://example.com/2021/10/28/Mybatis/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-10-28 21:48:03'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="boranの小さな巣" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/favicon.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">26</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> link</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-book"></i><span> books</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> about</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-list"></i><span> comments</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://ae01.alicdn.com/kf/U36fdd5af2ca24a5c8cf8bd7e3195e13bx.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">boranの小さな巣</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> link</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-book"></i><span> books</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> about</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-list"></i><span> comments</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Mybatis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-10-28T13:47:32.000Z" title="Created 2021-10-28 21:47:32">2021-10-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-10-28T13:48:03.788Z" title="Updated 2021-10-28 21:48:03">2021-10-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Mybatis"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/diffx/"><img src="https://raw.githubusercontent.com/chen-boran/Picture_bed/main/img/logo.gif" alt="返回主页"></a></p>
<h2 id="1-MyBatis简介"><a href="#1-MyBatis简介" class="headerlink" title="1.MyBatis简介"></a>1.MyBatis简介</h2><p>MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO </p>
<p>官方文档 <a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/getting-started.html">http://www.mybatis.org/mybatis-3/getting-started.html</a></p>
<h2 id="2-Mybaits整体架构"><a href="#2-Mybaits整体架构" class="headerlink" title="2.Mybaits整体架构"></a>2.Mybaits整体架构</h2><p><img src="https://raw.githubusercontent.com/chen-boran/Picture_bed/main/img/image-20211026214833917.png" alt="image-20211026214833917"></p>
<h2 id="3-流程概述"><a href="#3-流程概述" class="headerlink" title="3.流程概述"></a>3.流程概述</h2><h3 id="3-1-引入依赖（pom-xml）"><a href="#3-1-引入依赖（pom-xml）" class="headerlink" title="3.1.引入依赖（pom.xml）"></a>3.1.引入依赖（pom.xml）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.2.8&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-全局配置文件（mybatis-config-xml）"><a href="#3-2-全局配置文件（mybatis-config-xml）" class="headerlink" title="3.2.全局配置文件（mybatis-config.xml）"></a>3.2.全局配置文件（mybatis-config.xml）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">  PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Config 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">  &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;!-- 根标签 --&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">	&lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&#x2F;&gt;</span><br><span class="line">	&lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;mybatis-110?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;allowMultiQueries&#x3D;true&quot;&#x2F;&gt;</span><br><span class="line">	&lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot;&#x2F;&gt;</span><br><span class="line">    	&lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;123456&quot;&#x2F;&gt;</span><br><span class="line">   &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">   &lt;!-- 环境，可以配置多个，default：指定采用哪个环境 --&gt;</span><br><span class="line">   &lt;environments default&#x3D;&quot;test&quot;&gt;</span><br><span class="line">      &lt;!-- id：唯一标识 --&gt;</span><br><span class="line">      &lt;environment id&#x3D;&quot;test&quot;&gt;</span><br><span class="line">         &lt;!-- 事务管理器，JDBC类型的事务管理器 --&gt;</span><br><span class="line">         &lt;transactionManager type&#x3D;&quot;JDBC&quot; &#x2F;&gt;</span><br><span class="line">         &lt;!-- 数据源，池类型的数据源 --&gt;</span><br><span class="line">         &lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot; &#x2F;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;mybatis-110&quot; &#x2F;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot; &#x2F;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;123456&quot; &#x2F;&gt;</span><br><span class="line">         &lt;&#x2F;dataSource&gt;</span><br><span class="line">      &lt;&#x2F;environment&gt;</span><br><span class="line">      &lt;environment id&#x3D;&quot;development&quot;&gt;</span><br><span class="line">         &lt;!-- 事务管理器，JDBC类型的事务管理器 --&gt;</span><br><span class="line">         &lt;transactionManager type&#x3D;&quot;JDBC&quot; &#x2F;&gt;</span><br><span class="line">         &lt;!-- 数据源，池类型的数据源 --&gt;</span><br><span class="line">         &lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;$&#123;driver&#125;&quot; &#x2F;&gt; &lt;!-- 配置了properties，所以可以直接引用 --&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;$&#123;url&#125;&quot; &#x2F;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;username&#125;&quot; &#x2F;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;$&#123;password&#125;&quot; &#x2F;&gt;</span><br><span class="line">         &lt;&#x2F;dataSource&gt;</span><br><span class="line">      &lt;&#x2F;environment&gt;</span><br><span class="line">   &lt;&#x2F;environments&gt;</span><br><span class="line">  &lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-配置Map-xml"><a href="#3-3-配置Map-xml" class="headerlink" title="3.3.配置Map.xml"></a>3.3.配置Map.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">  PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">  &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;!-- mapper:根标签，namespace：命名空间，随便写，一般保证命名空间唯一 --&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;MyMapper&quot;&gt;</span><br><span class="line">   &lt;!-- statement，内容：sql语句。id：唯一标识，随便写，在同一个命名空间下保持唯一</span><br><span class="line">      resultType：sql语句查询结果集的封装类型,tb_user即为数据库中的表</span><br><span class="line">    --&gt;</span><br><span class="line">   &lt;select id&#x3D;&quot;selectUser&quot; resultType&#x3D;&quot;com.zpc.mybatis.User&quot;&gt;</span><br><span class="line">      select * from tb_user where id &#x3D; #&#123;id&#125;</span><br><span class="line">   &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-修改全局配置文件（mybatis-config-xml）"><a href="#3-4-修改全局配置文件（mybatis-config-xml）" class="headerlink" title="3.4.修改全局配置文件（mybatis-config.xml）"></a>3.4.修改全局配置文件（mybatis-config.xml）</h3><p>配上MyMapper.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">   &lt;!-- 环境，可以配置多个，default：指定采用哪个环境 --&gt;</span><br><span class="line">   &lt;environments default&#x3D;&quot;test&quot;&gt;</span><br><span class="line">      &lt;!-- id：唯一标识 --&gt;</span><br><span class="line">      &lt;environment id&#x3D;&quot;test&quot;&gt;</span><br><span class="line">         &lt;!-- 事务管理器，JDBC类型的事务管理器 --&gt;</span><br><span class="line">         &lt;transactionManager type&#x3D;&quot;JDBC&quot; &#x2F;&gt;</span><br><span class="line">         &lt;!-- 数据源，池类型的数据源 --&gt;</span><br><span class="line">         &lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot; &#x2F;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;ssmdemo&quot; &#x2F;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot; &#x2F;&gt;</span><br><span class="line">            &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;123456&quot; &#x2F;&gt;</span><br><span class="line">         &lt;&#x2F;dataSource&gt;</span><br><span class="line">      &lt;&#x2F;environment&gt;</span><br><span class="line">   &lt;&#x2F;environments&gt;</span><br><span class="line">   &lt;mappers&gt;</span><br><span class="line">     &lt;mapper resource&#x3D;&quot;mappers&#x2F;MyMapper.xml&quot; &#x2F;&gt;</span><br><span class="line">   &lt;&#x2F;mappers&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-构建sqlSessionFactory（MybatisTest-java）"><a href="#3-5-构建sqlSessionFactory（MybatisTest-java）" class="headerlink" title="3.5.构建sqlSessionFactory（MybatisTest.java）"></a>3.5.构建sqlSessionFactory（MybatisTest.java）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 指定全局配置文件</span><br><span class="line">       String resource &#x3D; &quot;mybatis-config.xml&quot;;</span><br><span class="line">       &#x2F;&#x2F; 读取配置文件</span><br><span class="line">       InputStream inputStream &#x3D; Resources.getResourceAsStream(resource);</span><br><span class="line">       &#x2F;&#x2F; 构建sqlSessionFactory</span><br><span class="line">       SqlSessionFactory sqlSessionFactory &#x3D; new SqlSessionFactoryBuilder().build(inputStream);</span><br></pre></td></tr></table></figure>

<h3 id="3-6-开启sqlSession会话，执行sql（MybatisTest-java）"><a href="#3-6-开启sqlSession会话，执行sql（MybatisTest-java）" class="headerlink" title="3.6.开启sqlSession会话，执行sql（MybatisTest.java）"></a>3.6.开启sqlSession会话，执行sql（MybatisTest.java）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 获取sqlSession</span><br><span class="line">      SqlSession sqlSession &#x3D; sqlSessionFactory.openSession();</span><br><span class="line">      &#x2F;&#x2F; 操作CRUD，第一个参数：指定statement，规则：命名空间+“.”+statementId</span><br><span class="line">      &#x2F;&#x2F; 第二个参数：指定传入sql的参数：这里是用户id</span><br><span class="line">      User user &#x3D; sqlSession.selectOne(&quot;MyMapper.selectUser&quot;, 1);</span><br><span class="line">      System.out.println(user);</span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h3 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h3><p>方便在控制台显示日志信息</p>
<p> 步骤 1：添加 Log4J 的 jar 包</p>
<p>我们使用的是 Log4J，要确保它的 jar 包可以被应用使用。需要将 jar 包添加到应用的类路径中。 </p>
<p>步骤 2：配置 Log4J</p>
<p>配置 Log4J 比较简单。假设你需要记录这个映射器的日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package org.mybatis.example;</span><br><span class="line">public interface BlogMapper &#123;</span><br><span class="line">  @Select(&quot;SELECT * FROM blog WHERE id &#x3D; #&#123;id&#125;&quot;)</span><br><span class="line">  Blog selectBlog(int id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在应用的类路径中创建一个名为 <code>log4j.properties</code> 的文件，文件的具体内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 全局日志配置</span><br><span class="line">log4j.rootLogger&#x3D;ERROR, stdout</span><br><span class="line"># MyBatis 日志配置</span><br><span class="line">log4j.logger.org.mybatis.example.BlogMapper&#x3D;TRACE</span><br><span class="line"># 控制台输出</span><br><span class="line">log4j.appender.stdout&#x3D;org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.layout&#x3D;org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern&#x3D;%5p [%t] - %m%n</span><br></pre></td></tr></table></figure>

<h3 id="MyBatis使用步骤"><a href="#MyBatis使用步骤" class="headerlink" title="MyBatis使用步骤"></a>MyBatis使用步骤</h3><ol>
<li><p>配置mybatis-config.xml 全局的配置文件 (1、数据源，2、外部的mapper)</p>
</li>
<li><p>创建SqlSessionFactory</p>
</li>
<li><p>通过SqlSessionFactory创建SqlSession对象</p>
</li>
<li><p>通过SqlSession操作数据库 CRUD</p>
</li>
<li><p>调用session.commit()提交事务</p>
</li>
<li><p>调用session.close()关闭会话</p>
</li>
</ol>
<h2 id="4-mybatis-config-xml详解"><a href="#4-mybatis-config-xml详解" class="headerlink" title="4.mybatis-config.xml详解"></a>4.mybatis-config.xml详解</h2><p>mybatis-config.xml讲究严格的顺序，具体顺序遵循文档的顺序</p>
<p><img src="https://raw.githubusercontent.com/chen-boran/Picture_bed/main/img/1456626-20190327210626940-903705426.png" alt="img"></p>
<h3 id="4-1-properties属性读取外部资源"><a href="#4-1-properties属性读取外部资源" class="headerlink" title="4.1.properties属性读取外部资源"></a>4.1.properties属性读取外部资源</h3><p>properties配置的属性都是可外部配置且可动态替换的，既可以在典型的 Java 属性文件中配置，亦可通过 properties 元素的子元素来传递。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties resource&#x3D;&quot;org&#x2F;mybatis&#x2F;example&#x2F;config.properties&quot;&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;dev_user&quot;&#x2F;&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;F2Fa3!33TYyg&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br></pre></td></tr></table></figure>

<p>然后其中的属性就可以在整个配置文件中被用来替换需要动态配置的属性值。比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;$&#123;driver&#125;&quot;&#x2F;&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;$&#123;url&#125;&quot;&#x2F;&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;username&#125;&quot;&#x2F;&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;$&#123;password&#125;&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;dataSource&gt;</span><br></pre></td></tr></table></figure>

<p>这个例子中的 username 和 password 将会由 properties 元素中设置的相应值来替换。 driver 和 url 属性将会由 config.properties 文件中对应的值来替换。这样就为配置提供了诸多灵活选择。</p>
<p>属性也可以被传递到 SqlSessionFactoryBuilder.build()方法中。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactory factory &#x3D; new SqlSessionFactoryBuilder().build(reader, props);</span><br><span class="line">&#x2F;&#x2F; ... or ...</span><br><span class="line">SqlSessionFactory factory &#x3D; new SqlSessionFactoryBuilder().build(reader, environment, props);</span><br></pre></td></tr></table></figure>

<p>如果属性在不只一个地方进行了配置，那么 MyBatis 将按照下面的顺序来加载：</p>
<ul>
<li>1）在 properties 元素体内指定的属性首先被读取。</li>
<li>2）然后根据 properties 元素中的 resource 属性读取类路径下属性文件或根据 url 属性指定的路径读取属性文件，并覆盖已读取的同名属性。</li>
<li>3）最后读取作为方法参数传递的属性，并覆盖已读取的同名属性。</li>
</ul>
<p><strong>因此，通过方法参数传递的属性具有最高优先级，resource/url 属性中指定的配置文件次之，最低优先级的是 properties 属性中指定的属性。</strong></p>
<p>8.2.settings设置</p>
<p><img src="https://img2018.cnblogs.com/blog/1456626/201903/1456626-20190327210741776-205936991.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">    &lt;setting name&#x3D;&quot;mapUnderscoreToCamelCase&quot; value&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br></pre></td></tr></table></figure>

<p>测试：<br>没有开启驼峰匹配：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-07-01 13:57:56,486 [main] [com.zpc.mybatis.dao.UserMapper.queryUserById]-[DEBUG] &#x3D;&#x3D;&gt;  Preparing: select * from tb_user where id &#x3D; ? </span><br><span class="line">2018-07-01 13:57:56,524 [main] [com.zpc.mybatis.dao.UserMapper.queryUserById]-[DEBUG] &#x3D;&#x3D;&gt; Parameters: 1(String)</span><br><span class="line">2018-07-01 13:57:56,568 [main] [com.zpc.mybatis.dao.UserMapper.queryUserById]-[DEBUG] &lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">User&#123;id&#x3D;&#39;1&#39;, userName&#x3D;&#39;null&#39;, password&#x3D;&#39;123456&#39;, name&#x3D;&#39;大神&#39;, age&#x3D;20, sex&#x3D;2, birthday&#x3D;&#39;2018-07-01&#39;, created&#x3D;&#39;2018-07-01 13:36:09.0&#39;, updated&#x3D;&#39;2018-07-01 13:36:09.0&#39;&#125;</span><br></pre></td></tr></table></figure>

<p>开启驼峰匹配：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-07-01 13:58:40,599 [main] [com.zpc.mybatis.dao.UserMapper.queryUserById]-[DEBUG] &#x3D;&#x3D;&gt;  Preparing: select * from tb_user where id &#x3D; ? </span><br><span class="line">2018-07-01 13:58:40,642 [main] [com.zpc.mybatis.dao.UserMapper.queryUserById]-[DEBUG] &#x3D;&#x3D;&gt; Parameters: 1(String)</span><br><span class="line">2018-07-01 13:58:40,661 [main] [com.zpc.mybatis.dao.UserMapper.queryUserById]-[DEBUG] &lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">User&#123;id&#x3D;&#39;1&#39;, userName&#x3D;&#39;bigGod222&#39;, password&#x3D;&#39;123456&#39;, name&#x3D;&#39;大神&#39;, age&#x3D;20, sex&#x3D;2, birthday&#x3D;&#39;2018-07-01&#39;, created&#x3D;&#39;2018-07-01 13:36:09.0&#39;, updated&#x3D;&#39;2018-07-01 13:36:09.0&#39;&#125;</span><br></pre></td></tr></table></figure>

<p>8.3.typeAliases<br>类型别名是为 Java 类型命名的一个短的名字。它只和 XML 配置有关，存在的意义仅在于用来减少类完全限定名的冗余。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">    &lt;typeAlias type&#x3D;&quot;com.zpc.mybatis.pojo.User&quot; alias&#x3D;&quot;User&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;typeAliases&gt;</span><br></pre></td></tr></table></figure>

<p><strong>缺点</strong>：每个pojo类都要去配置。<br><strong>解决方案</strong>：使用扫描包，扫描指定包下的所有类，扫描之后的别名就是类名（不区分大小写），建议使用的时候和类名一致。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">    &lt;!--type:实体类的全路径。alias:别名，通常首字母大写--&gt;</span><br><span class="line">    &lt;!--&lt;typeAlias type&#x3D;&quot;com.zpc.mybatis.pojo.User&quot; alias&#x3D;&quot;User&quot;&#x2F;&gt;--&gt;</span><br><span class="line">    &lt;package name&#x3D;&quot;com.zpc.mybatis.pojo&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;typeAliases&gt;</span><br></pre></td></tr></table></figure>

<p>Mybatis已经为普通的 Java 类型内建了许多相应的类型别名。它们都是大小写不敏感的.</p>
<p><img src="https://raw.githubusercontent.com/chen-boran/Picture_bed/main/img/1456626-20190327210946024-1568261798.png" alt="img"></p>
<h3 id="4-4-typeHandlers（类型处理器）"><a href="#4-4-typeHandlers（类型处理器）" class="headerlink" title="4.4.typeHandlers（类型处理器）"></a>4.4.typeHandlers（类型处理器）</h3><p>无论是 MyBatis 在预处理语句（PreparedStatement）中设置一个参数时，还是从结果集中取出一个值时， 都会用类型处理器将获取的值以合适的方式转换成 Java 类型。可以重写类型处理器或创建你自己的类型处理器来处理不支持的或非标准的类型。</p>
<h3 id="4-5-plugins（插件）拦截器"><a href="#4-5-plugins（插件）拦截器" class="headerlink" title="4.5.plugins（插件）拦截器"></a>4.5.plugins（插件）拦截器</h3><p>MyBatis 允许你在已映射语句执行过程中的某一点进行拦截调用。默认情况下，MyBatis 允许使用插件来拦截的方法调用包括：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</span><br><span class="line">ParameterHandler (getParameterObject, setParameters)</span><br><span class="line">ResultSetHandler (handleResultSets, handleOutputParameters)</span><br><span class="line">StatementHandler (prepare, parameterize, batch, update, query)</span><br></pre></td></tr></table></figure>

<p>现在一些MyBatis 插件比如PageHelper都是基于这个原理，有时为了监控sql执行效率，也可以使用插件机制<br>原理：</p>
<p><img src="https://img2018.cnblogs.com/blog/1456626/201903/1456626-20190327211135308-2074954352.png" alt="img"></p>
<p>自定义拦截器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ExamplePlugin.java</span><br><span class="line">@Intercepts(&#123;@Signature(</span><br><span class="line">  type&#x3D; Executor.class,</span><br><span class="line">  method &#x3D; &quot;update&quot;,</span><br><span class="line">  args &#x3D; &#123;MappedStatement.class,Object.class&#125;)&#125;)</span><br><span class="line">public class ExamplePlugin implements Interceptor &#123;</span><br><span class="line">  public Object intercept(Invocation invocation) throws Throwable &#123;</span><br><span class="line">    return invocation.proceed();</span><br><span class="line">  &#125;</span><br><span class="line">  public Object plugin(Object target) &#123;</span><br><span class="line">    return Plugin.wrap(target, this);</span><br><span class="line">  &#125;</span><br><span class="line">  public void setProperties(Properties properties) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mybatis-config.xml --&gt;</span><br><span class="line">&lt;plugins&gt;</span><br><span class="line">  &lt;plugin interceptor&#x3D;&quot;org.mybatis.example.ExamplePlugin&quot;&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;someProperty&quot; value&#x3D;&quot;100&quot;&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;plugin&gt;</span><br><span class="line">&lt;&#x2F;plugins&gt;</span><br></pre></td></tr></table></figure>

<p>上面的插件将会拦截在 Executor 实例中所有的 “update” 方法调用， 这里的 Executor 是负责执行低层映射语句的内部对象。</p>
<h3 id="4-6-environments-环境"><a href="#4-6-environments-环境" class="headerlink" title="4.6.environments(环境)"></a>4.6.environments(环境)</h3><p>MyBatis 可以配置成适应多种环境，例如，开发、测试和生产环境需要有不同的配置；<br>尽管可以配置多个环境，每个 SqlSessionFactory 实例只能选择其一。<br>虽然，这种方式也可以做到很方便的分离多个环境，但是实际使用场景下，我们更多的是选择使用spring来管理数据源，来做到环境的分离。</p>
<h3 id="4-7-mappers"><a href="#4-7-mappers" class="headerlink" title="4.7.mappers"></a>4.7.mappers</h3><p>需要告诉 MyBatis 到哪里去找到 SQL 映射语句。即告诉 MyBatis 到哪里去找映射文件。你可以使用相对于类路径的资源引用， 或完全限定资源定位符（包括 file:/// 的 URL），或类名和包名等。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper resource&#x3D;&quot;org&#x2F;mybatis&#x2F;builder&#x2F;AuthorMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">  &lt;mapper resource&#x3D;&quot;org&#x2F;mybatis&#x2F;builder&#x2F;BlogMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">  &lt;mapper resource&#x3D;&quot;org&#x2F;mybatis&#x2F;builder&#x2F;PostMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper class&#x3D;&quot;org.mybatis.builder.AuthorMapper&quot;&#x2F;&gt;</span><br><span class="line">  &lt;mapper class&#x3D;&quot;org.mybatis.builder.BlogMapper&quot;&#x2F;&gt;</span><br><span class="line">  &lt;mapper class&#x3D;&quot;org.mybatis.builder.PostMapper&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;mappers&gt;</span><br></pre></td></tr></table></figure>

<p>这里所谓的mapper接口路径。实际上就是dao的接口路径。在mybatis中，通常把dao的包叫做mapper。类名，也叫做mapper</p>
<ul>
<li>1、定义一个接口。</li>
<li>2、在接口所在的包中定义mapper.xml，并且要求xml文件和interface的名称要相同。</li>
<li>3、在mybatis-config.xml 中通过class路径，引入mapper（注解方式）。要求mapper.xml 中的名称空间是类的接口的全路径。</li>
</ul>
<p>注解方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;mapper resource&#x3D;&quot;mappers&#x2F;MyMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">    &lt;mapper resource&#x3D;&quot;mappers&#x2F;UserDaoMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">    &lt;!--注解方式可以使用如下配置方式--&gt;</span><br><span class="line">    &lt;mapper class&#x3D;&quot;com.zpc.mybatis.dao.UserMapper&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;mappers&gt;</span><br></pre></td></tr></table></figure>

<p><em>问题：</em></p>
<ul>
<li>1、mapper.xml 和 java文件没有分离。 之后的教程讲述和spring整合之后解决。</li>
<li>2、需要一个一个的去加载mapper。</li>
</ul>
<p>当然也可以使用包扫描（必须使用注解方式，即在接口方法上使用注解，如@Select(“select * from tb_user “)）：<br><em>缺点</em>：</p>
<ul>
<li>1、如果包的路径有很多？</li>
<li>2、mapper.xml和mapper.java没有分离。<br>spring整合的时候解决。</li>
</ul>
<h2 id="5-Mapper-XML文件详解"><a href="#5-Mapper-XML文件详解" class="headerlink" title="5.Mapper XML文件详解"></a>5.Mapper XML文件详解</h2><h3 id="5-1-CRUD标签"><a href="#5-1-CRUD标签" class="headerlink" title="5.1.CRUD标签"></a>5.1.CRUD标签</h3><h4 id="5-1-1-select"><a href="#5-1-1-select" class="headerlink" title="5.1.1.select"></a>5.1.1.select</h4><p>select – 书写查询sql语句<br>select中的几个属性说明：<br>id属性：当前名称空间下的statement的唯一标识。必须。要求id和mapper接口中的方法的名字一致。<br>resultType：将结果集映射为java的对象类型。必须（和 resultMap 二选一）<br>parameterType：传入参数类型。可以省略</p>
<h4 id="5-1-2-insert"><a href="#5-1-2-insert" class="headerlink" title="5.1.2.insert"></a>5.1.2.insert</h4><p>insert 的几个属性说明：<br>id：唯一标识，随便写，在同一个命名空间下保持唯一，使用动态代理之后要求和方法名保持一致<br>parameterType：参数的类型，使用动态代理之后和方法的参数类型一致<br>useGeneratedKeys:开启主键回写<br>keyColumn：指定数据库的主键<br>keyProperty：主键对应的pojo属性名<br>标签内部：具体的sql语句。</p>
<h4 id="5-1-3-update"><a href="#5-1-3-update" class="headerlink" title="5.1.3.update"></a>5.1.3.update</h4><p>id属性：当前名称空间下的statement的唯一标识(必须属性)；<br>parameterType：传入的参数类型，可以省略。<br>标签内部：具体的sql语句。</p>
<h4 id="5-1-4-delete"><a href="#5-1-4-delete" class="headerlink" title="5.1.4.delete"></a>5.1.4.delete</h4><p>delete 的几个属性说明：<br>id属性：当前名称空间下的statement的唯一标识(必须属性)；<br>parameterType：传入的参数类型，可以省略。<br>标签内部：具体的sql语句。</p>
<h3 id="5-2-和"><a href="#5-2-和" class="headerlink" title="5.2.#{}和${}"></a>5.2.#{}和${}</h3><p>场景：数据库有两个一模一样的表。历史表，当前表<br>查询表中的信息，有时候从历史表中去查询数据，有时候需要去新的表去查询数据。<br>希望使用1个方法来完成操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;queryUserByTableName&quot; resultType&#x3D;&quot;com.zpc.mybatis.pojo.User&quot;&gt;</span><br><span class="line">    select * from #&#123;tableName&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 根据表名查询用户信息（直接使用注解指定传入参数名称）</span><br><span class="line"> *</span><br><span class="line"> * @param tableName</span><br><span class="line"> * @return</span><br><span class="line"> *&#x2F;</span><br><span class="line">public List&lt;User&gt; queryUserByTableName(String tableName);</span><br></pre></td></tr></table></figure>

<p>测试输出：</p>
<p><img src="https://raw.githubusercontent.com/chen-boran/Picture_bed/main/img/1456626-20190327211514143-697503265.png" alt="img"></p>
<p>有问题,报语法错误：相当于执行了这样一条sql:<br><code>select * from “tb_user”;</code><br>显然表名多了引号。</p>
<p>改正：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;queryUserByTableName&quot; resultType&#x3D;&quot;com.zpc.mybatis.pojo.User&quot;&gt;</span><br><span class="line">    select * from $&#123;tableName&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p><em>注意：</em><br><code>#&#123;&#125;</code> 只是替换？，相当于PreparedStatement使用占位符去替换参数，可以防止sql注入。<br><code>$&#123;&#125;</code> 是进行字符串拼接，相当于sql语句中的Statement，使用字符串去拼接sql；$可以是sql中的任一部分传入到Statement中，不能防止sql注入。</p>
<p>使用<code>$&#123;&#125;</code> 去取出参数值信息，需要使用<code>$&#123;value&#125;</code><br><code>#&#123;&#125;</code> 只是表示占位，与参数的名字无关，如果只有一个参数，会自动对应。</p>
<p>推荐：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 根据表名查询用户信息（直接使用注解指定传入参数名称）</span><br><span class="line"> *</span><br><span class="line"> * @param tableName</span><br><span class="line"> * @return</span><br><span class="line"> *&#x2F;</span><br><span class="line">public List&lt;User&gt; queryUserByTableName(@Param(&quot;tableName&quot;) String tableName);</span><br><span class="line"></span><br><span class="line">&lt;select id&#x3D;&quot;queryUserByTableName&quot; resultType&#x3D;&quot;com.zpc.mybatis.pojo.User&quot;&gt;</span><br><span class="line">    select * from $&#123;tableName&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p><code>#&#123;&#125;</code>多个参数时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 登录（直接使用注解指定传入参数名称）</span><br><span class="line"> *</span><br><span class="line"> * @param userName</span><br><span class="line"> * @param password</span><br><span class="line"> * @return</span><br><span class="line"> *&#x2F;</span><br><span class="line">public User login( String userName, String password);</span><br><span class="line"></span><br><span class="line">&lt;select id&#x3D;&quot;login&quot; resultType&#x3D;&quot;com.zpc.mybatis.pojo.User&quot;&gt;</span><br><span class="line">    select * from tb_user where user_name &#x3D; #&#123;userName&#125; and password &#x3D; #&#123;password&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.exceptions.PersistenceException: </span><br><span class="line">Error querying database.  Cause: org.apache.ibatis.binding.BindingException: Parameter &#39;userName&#39; not found. Available parameters are [0, 1, param1, param2]</span><br><span class="line">Cause: org.apache.ibatis.binding.BindingException: Parameter &#39;userName&#39; not found. Available parameters are [0, 1, param1, param2]</span><br></pre></td></tr></table></figure>

<p>解决方案一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;login&quot; resultType&#x3D;&quot;com.zpc.mybatis.pojo.User&quot;&gt;</span><br><span class="line">    select * from tb_user where user_name &#x3D; #&#123;0&#125; and password &#x3D; #&#123;1&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>解决方案二：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;login&quot; resultType&#x3D;&quot;com.zpc.mybatis.pojo.User&quot;&gt;</span><br><span class="line">    select * from tb_user where user_name &#x3D; #&#123;param1&#125; and password &#x3D; #&#123;param2&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>最终解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 登录（直接使用注解指定传入参数名称）</span><br><span class="line"> *</span><br><span class="line"> * @param userName</span><br><span class="line"> * @param password</span><br><span class="line"> * @return</span><br><span class="line"> *&#x2F;</span><br><span class="line">public User login(@Param(&quot;userName&quot;) String userName, @Param(&quot;password&quot;) String password);</span><br><span class="line"></span><br><span class="line">&lt;select id&#x3D;&quot;login&quot; resultType&#x3D;&quot;com.zpc.mybatis.pojo.User&quot;&gt;</span><br><span class="line">    select * from tb_user where user_name &#x3D; #&#123;userName&#125; and password &#x3D; #&#123;password&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通常在方法的参数列表上加上一个注释@Param(“xxxx”) 显式指定参数的名字，然后通过${“xxxx”}或#{“xxxx”}<br>sql语句动态生成的时候，使用${};<br>sql语句中某个参数进行占位的时候#{}</p>
</blockquote>
<h3 id="5-3-、-区别"><a href="#5-3-、-区别" class="headerlink" title="5.3.#、$区别"></a>5.3.#、$区别</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * #号</span><br><span class="line"> * @param username1</span><br><span class="line"> * @return</span><br><span class="line"> *&#x2F;</span><br><span class="line">User queryUserListByName1(@Param(&quot;username1&quot;) String username1);</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * $号</span><br><span class="line"> * @param username2</span><br><span class="line"> * @return</span><br><span class="line"> *&#x2F;</span><br><span class="line">User queryUserListByName2(@Param(&quot;username2&quot;) String username2);</span><br><span class="line"></span><br><span class="line">&lt;select id&#x3D;&quot;queryUserListByName1&quot; resultType&#x3D;&quot;com.zpc.mybatis.pojo.User&quot;&gt;</span><br><span class="line">    select * from tb_user WHERE user_name&#x3D;#&#123;username1&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id&#x3D;&quot;queryUserListByName2&quot; resultType&#x3D;&quot;com.zpc.mybatis.pojo.User&quot;&gt;</span><br><span class="line">    select * from tb_user WHERE user_name&#x3D;&#39;$&#123;username2&#125;&#39;&#x2F;&#x2F;手动加了引号</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-resultMap"><a href="#5-4-resultMap" class="headerlink" title="5.4.resultMap"></a>5.4.resultMap</h3><p><img src="https://raw.githubusercontent.com/chen-boran/Picture_bed/main/img/1456626-20190327211835662-809178670.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/chen-boran/Picture_bed/main/img/1456626-20190327211845574-1504006745.png" alt="img"></p>
<p>使用：</p>
<p><img src="https://img2018.cnblogs.com/blog/1456626/201903/1456626-20190327211856049-978145666.png" alt="img"></p>
<h3 id="5-5-sql片段"><a href="#5-5-sql片段" class="headerlink" title="5.5.sql片段"></a>5.5.sql片段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;sql id&#x3D;””&gt;&lt;&#x2F;sql&gt;</span><br><span class="line">&lt;include refId&#x3D;”” &#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p>例如在UserMapper.xml中定义如下片段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;sql id&#x3D;&quot;commonSql&quot;&gt;</span><br><span class="line">		id,</span><br><span class="line">			user_name,</span><br><span class="line">			password,</span><br><span class="line">			name,</span><br><span class="line">			age,</span><br><span class="line">			sex,</span><br><span class="line">			birthday,</span><br><span class="line">			created,</span><br><span class="line">			updated	</span><br><span class="line">&lt;&#x2F;sql&gt; </span><br></pre></td></tr></table></figure>

<p>则可以在UserMapper.xml中使用它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;queryUserById&quot; resultMap&#x3D;&quot;userResultMap&quot;&gt;</span><br><span class="line">	select &lt;include refid&#x3D;&quot;commonSql&quot;&gt;&lt;&#x2F;include&gt; from tb_user where id &#x3D; #&#123;id&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id&#x3D;&quot;queryUsersLikeUserName&quot; resultType&#x3D;&quot;User&quot;&gt;</span><br><span class="line">	select &lt;include refid&#x3D;&quot;commonSql&quot;&gt;&lt;&#x2F;include&gt; from tb_user where user_name like &quot;%&quot;#&#123;userName&#125;&quot;%&quot;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>Sql片段也可以定义在单独的.xml文件中如：<br>定义CommonSQL.xml：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">  PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">  &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;CommonSQL&quot;&gt;</span><br><span class="line">	&lt;sql id&#x3D;&quot;commonSql&quot;&gt;</span><br><span class="line">		id,</span><br><span class="line">			user_name,</span><br><span class="line">			password,</span><br><span class="line">			name,</span><br><span class="line">			age,</span><br><span class="line">			sex,</span><br><span class="line">			birthday,</span><br><span class="line">			created,</span><br><span class="line">			updated	</span><br><span class="line">	&lt;&#x2F;sql&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;queryUserById&quot; resultMap&#x3D;&quot;userResultMap&quot;&gt;</span><br><span class="line">	select &lt;include refid&#x3D;&quot;CommonSQL.commonSql&quot;&gt;&lt;&#x2F;include&gt; from tb_user where id &#x3D; #&#123;id&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id&#x3D;&quot;queryUsersLikeUserName&quot; resultType&#x3D;&quot;User&quot;&gt;</span><br><span class="line">	select &lt;include refid&#x3D;&quot;CommonSQL.commonSql&quot;&gt;&lt;&#x2F;include&gt; from tb_user where user_name like &quot;%&quot;#&#123;userName&#125;&quot;%&quot;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>当然要完成这个功能还需要在全局配置文件mybatis-config.xml中引入该外部配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">		&lt;mapper resource&#x3D;&quot;CommonSQL.xml&quot;&#x2F;&gt;</span><br><span class="line">		&lt;!-- 开启mapper接口的包扫描，基于class的配置方式 --&gt;</span><br><span class="line">		&lt;package name&#x3D;&quot;com.zpc.mybatis.mapper&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;mappers&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-动态sql"><a href="#6-动态sql" class="headerlink" title="6.动态sql"></a>6.动态sql</h2><p>动态 SQL 是 MyBatis 的强大特性之一， 解决了根据不同条件拼接 SQL 语句 </p>
<p> 借助可用于任何 SQL 映射语句中的强大的动态 SQL 语言，MyBatis 显著地提升了这一特性的易用性。</p>
<p> 动态sql常用标签</p>
<ul>
<li>if</li>
<li>choose (when, otherwise)</li>
<li>trim (where, set)</li>
<li>foreach</li>
</ul>
<h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p>使用动态 SQL 最常见情景是根据条件包含 where 子句的一部分。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findActiveBlogWithTitleLike&quot;</span><br><span class="line">     resultType&#x3D;&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE state &#x3D; ‘ACTIVE’</span><br><span class="line">  &lt;if test&#x3D;&quot;title !&#x3D; null&quot;&gt;&#x2F;&#x2F;使用text</span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  &lt;&#x2F;if&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>这条语句提供了可选的查找文本功能。如果不传入 “title”，那么所有处于 “ACTIVE” 状态的 BLOG 都会返回；如果传入了 “title” 参数，那么就会对 “title” 一列进行模糊查找并返回对应的 BLOG 结果 。</p>
<p>如果希望通过 “title” 和 “author” 两个参数进行可选搜索.首先，我想先将语句名称修改成更名副其实的名称；接下来，只需要加入另一个条件即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType&#x3D;&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG WHERE state &#x3D; ‘ACTIVE’</span><br><span class="line">  &lt;if test&#x3D;&quot;title !&#x3D; null&quot;&gt;</span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  &lt;&#x2F;if&gt;</span><br><span class="line">  &lt;if test&#x3D;&quot;author !&#x3D; null and author.name !&#x3D; null&quot;&gt;</span><br><span class="line">    AND author_name like #&#123;author.name&#125;</span><br><span class="line">  &lt;&#x2F;if&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>



<h3 id="choose、when、otherwise"><a href="#choose、when、otherwise" class="headerlink" title="choose、when、otherwise"></a>choose、when、otherwise</h3><p>有时候，我们不想使用所有的条件，而只是想从多个条件中选择一个使用。 </p>
<p>MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。</p>
<p>还是上面的例子，但是策略变为：传入了 “title” 就按 “title” 查找，传入了 “author” 就按 “author” 查找的情形。若两者都没有传入，就返回标记为 featured 的 BLOG（这可能是管理员认为，与其返回大量的无意义随机 Blog，还不如返回一些由管理员精选的 Blog）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType&#x3D;&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG WHERE state &#x3D; ‘ACTIVE’</span><br><span class="line">  &lt;choose&gt;</span><br><span class="line">    &lt;when test&#x3D;&quot;title !&#x3D; null&quot;&gt;</span><br><span class="line">      AND title like #&#123;title&#125;</span><br><span class="line">    &lt;&#x2F;when&gt;</span><br><span class="line">    &lt;when test&#x3D;&quot;author !&#x3D; null and author.name !&#x3D; null&quot;&gt;</span><br><span class="line">      AND author_name like #&#123;author.name&#125;</span><br><span class="line">    &lt;&#x2F;when&gt;</span><br><span class="line">    &lt;otherwise&gt;</span><br><span class="line">      AND featured &#x3D; 1</span><br><span class="line">    &lt;&#x2F;otherwise&gt;</span><br><span class="line">  &lt;&#x2F;choose&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>



<h3 id="trim、where、set"><a href="#trim、where、set" class="headerlink" title="trim、where、set"></a>trim、where、set</h3><p>前面几个例子已经方便地解决了一个臭名昭著的动态 SQL 问题。现在回到之前的 “if” 示例，这次我们将 “state = ‘ACTIVE’” 设置成动态条件，看看会发生什么。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType&#x3D;&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE</span><br><span class="line">  &lt;if test&#x3D;&quot;state !&#x3D; null&quot;&gt;</span><br><span class="line">    state &#x3D; #&#123;state&#125;</span><br><span class="line">  &lt;&#x2F;if&gt;</span><br><span class="line">  &lt;if test&#x3D;&quot;title !&#x3D; null&quot;&gt;</span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  &lt;&#x2F;if&gt;</span><br><span class="line">  &lt;if test&#x3D;&quot;author !&#x3D; null and author.name !&#x3D; null&quot;&gt;</span><br><span class="line">    AND author_name like #&#123;author.name&#125;</span><br><span class="line">  &lt;&#x2F;if&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>如果没有匹配的条件会怎么样？最终这条 SQL 会变成这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM BLOG</span><br><span class="line">WHERE</span><br></pre></td></tr></table></figure>

<p>这会导致查询失败。如果匹配的只是第二个条件又会怎样？这条 SQL 会是这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM BLOG</span><br><span class="line">WHERE</span><br><span class="line">AND title like ‘someTitle’</span><br></pre></td></tr></table></figure>

<p>这个查询也会失败。这个问题不能简单地用条件元素来解决。这个问题是如此的难以解决，以至于解决过的人不会再想碰到这种问题。</p>
<p>MyBatis 有一个简单且适合大多数场景的解决办法。而在其他场景中，可以对其进行自定义以符合需求。而这，只需要一处简单的改动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType&#x3D;&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;if test&#x3D;&quot;state !&#x3D; null&quot;&gt;</span><br><span class="line">         state &#x3D; #&#123;state&#125;</span><br><span class="line">    &lt;&#x2F;if&gt;</span><br><span class="line">    &lt;if test&#x3D;&quot;title !&#x3D; null&quot;&gt;</span><br><span class="line">        AND title like #&#123;title&#125;</span><br><span class="line">    &lt;&#x2F;if&gt;</span><br><span class="line">    &lt;if test&#x3D;&quot;author !&#x3D; null and author.name !&#x3D; null&quot;&gt;</span><br><span class="line">        AND author_name like #&#123;author.name&#125;</span><br><span class="line">    &lt;&#x2F;if&gt;</span><br><span class="line">  &lt;&#x2F;where&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p><em>where</em> 元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句。而且，若子句的开头为 “AND” 或 “OR”，<em>where</em> 元素也会将它们去除。</p>
<p>如果 <em>where</em> 元素与你期望的不太一样，你也可以通过自定义 trim 元素来定制 <em>where</em> 元素的功能。比如，和 <em>where</em> 元素等价的自定义 trim 元素为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;trim prefix&#x3D;&quot;WHERE&quot; prefixOverrides&#x3D;&quot;AND |OR &quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;trim&gt;</span><br></pre></td></tr></table></figure>

<p><em>prefixOverrides</em> 属性会忽略通过管道符分隔的文本序列（注意此例中的空格是必要的）。上述例子会移除所有 <em>prefixOverrides</em> 属性中指定的内容，并且插入 <em>prefix</em> 属性中指定的内容。</p>
<p>用于动态更新语句的类似解决方案叫做 <em>set</em>。<em>set</em> 元素可以用于动态包含需要更新的列，忽略其它不更新的列。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id&#x3D;&quot;updateAuthorIfNecessary&quot;&gt;</span><br><span class="line">  update Author</span><br><span class="line">    &lt;set&gt;</span><br><span class="line">      &lt;if test&#x3D;&quot;username !&#x3D; null&quot;&gt;username&#x3D;#&#123;username&#125;,&lt;&#x2F;if&gt;</span><br><span class="line">      &lt;if test&#x3D;&quot;password !&#x3D; null&quot;&gt;password&#x3D;#&#123;password&#125;,&lt;&#x2F;if&gt;</span><br><span class="line">      &lt;if test&#x3D;&quot;email !&#x3D; null&quot;&gt;email&#x3D;#&#123;email&#125;,&lt;&#x2F;if&gt;</span><br><span class="line">      &lt;if test&#x3D;&quot;bio !&#x3D; null&quot;&gt;bio&#x3D;#&#123;bio&#125;&lt;&#x2F;if&gt;</span><br><span class="line">    &lt;&#x2F;set&gt;</span><br><span class="line">  where id&#x3D;#&#123;id&#125;</span><br><span class="line">&lt;&#x2F;update&gt;</span><br></pre></td></tr></table></figure>

<p>这个例子中，<em>set</em> 元素会动态地在行首插入 SET 关键字，并会删掉额外的逗号（这些逗号是在使用条件语句给列赋值时引入的）。</p>
<p>来看看与 <em>set</em> 元素等价的自定义 <em>trim</em> 元素吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;trim prefix&#x3D;&quot;SET&quot; suffixOverrides&#x3D;&quot;,&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;trim&gt;</span><br></pre></td></tr></table></figure>

<p>注意，我们覆盖了后缀值设置，并且自定义了前缀值。</p>
<h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h3><p>动态 SQL 的另一个常见使用场景是对集合进行遍历（尤其是在构建 IN 条件语句的时候）。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;selectPostIn&quot; resultType&#x3D;&quot;domain.blog.Post&quot;&gt;</span><br><span class="line">  SELECT *</span><br><span class="line">  FROM POST P</span><br><span class="line">  WHERE ID in</span><br><span class="line">  &lt;foreach item&#x3D;&quot;item&quot; index&#x3D;&quot;index&quot; collection&#x3D;&quot;list&quot;</span><br><span class="line">      open&#x3D;&quot;(&quot; separator&#x3D;&quot;,&quot; close&#x3D;&quot;)&quot;&gt;</span><br><span class="line">        #&#123;item&#125;</span><br><span class="line">  &lt;&#x2F;foreach&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p><em>foreach</em> 元素的功能非常强大，它允许你指定一个集合，声明可以在元素体内使用的集合项（item）和索引（index）变量。它也允许你指定开头与结尾的字符串以及集合项迭代之间的分隔符。这个元素也不会错误地添加多余的分隔符，看它多智能！</p>
<p><strong>提示</strong> 你可以将任何可迭代对象（如 List、Set 等）、Map 对象或者数组对象作为集合参数传递给 <em>foreach</em>。当使用可迭代对象或者数组时，index 是当前迭代的序号，item 的值是本次迭代获取到的元素。当使用 Map 对象（或者 Map.Entry 对象的集合）时，index 是键，item 是值。</p>
<p>至此，我们已经完成了与 XML 配置及映射文件相关的讨论。下一章将详细探讨 Java API，以便你能充分利用已经创建的映射配置。</p>
<h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><p>要在带注解的映射器接口类中使用动态 SQL，可以使用 <em>script</em> 元素。比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Update(&#123;&quot;&lt;script&gt;&quot;,</span><br><span class="line">  &quot;update Author&quot;,</span><br><span class="line">  &quot;  &lt;set&gt;&quot;,</span><br><span class="line">  &quot;    &lt;if test&#x3D;&#39;username !&#x3D; null&#39;&gt;username&#x3D;#&#123;username&#125;,&lt;&#x2F;if&gt;&quot;,</span><br><span class="line">  &quot;    &lt;if test&#x3D;&#39;password !&#x3D; null&#39;&gt;password&#x3D;#&#123;password&#125;,&lt;&#x2F;if&gt;&quot;,</span><br><span class="line">  &quot;    &lt;if test&#x3D;&#39;email !&#x3D; null&#39;&gt;email&#x3D;#&#123;email&#125;,&lt;&#x2F;if&gt;&quot;,</span><br><span class="line">  &quot;    &lt;if test&#x3D;&#39;bio !&#x3D; null&#39;&gt;bio&#x3D;#&#123;bio&#125;&lt;&#x2F;if&gt;&quot;,</span><br><span class="line">  &quot;  &lt;&#x2F;set&gt;&quot;,</span><br><span class="line">  &quot;where id&#x3D;#&#123;id&#125;&quot;,</span><br><span class="line">  &quot;&lt;&#x2F;script&gt;&quot;&#125;)</span><br><span class="line">void updateAuthorValues(Author author);</span><br></pre></td></tr></table></figure>

<h3 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h3><p><code>bind</code> 元素允许你在 OGNL 表达式以外创建一个变量，并将其绑定到当前的上下文。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;selectBlogsLike&quot; resultType&#x3D;&quot;Blog&quot;&gt;</span><br><span class="line">  &lt;bind name&#x3D;&quot;pattern&quot; value&#x3D;&quot;&#39;%&#39; + _parameter.getTitle() + &#39;%&#39;&quot; &#x2F;&gt;</span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE title LIKE #&#123;pattern&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<h3 id="多数据库支持"><a href="#多数据库支持" class="headerlink" title="多数据库支持"></a>多数据库支持</h3><p>如果配置了 databaseIdProvider，你就可以在动态代码中使用名为 “_databaseId” 的变量来为不同的数据库构建特定的语句。比如下面的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id&#x3D;&quot;insert&quot;&gt;</span><br><span class="line">  &lt;selectKey keyProperty&#x3D;&quot;id&quot; resultType&#x3D;&quot;int&quot; order&#x3D;&quot;BEFORE&quot;&gt;</span><br><span class="line">    &lt;if test&#x3D;&quot;_databaseId &#x3D;&#x3D; &#39;oracle&#39;&quot;&gt;</span><br><span class="line">      select seq_users.nextval from dual</span><br><span class="line">    &lt;&#x2F;if&gt;</span><br><span class="line">    &lt;if test&#x3D;&quot;_databaseId &#x3D;&#x3D; &#39;db2&#39;&quot;&gt;</span><br><span class="line">      select nextval for seq_users from sysibm.sysdummy1&quot;</span><br><span class="line">    &lt;&#x2F;if&gt;</span><br><span class="line">  &lt;&#x2F;selectKey&gt;</span><br><span class="line">  insert into users values (#&#123;id&#125;, #&#123;name&#125;)</span><br><span class="line">&lt;&#x2F;insert&gt;</span><br></pre></td></tr></table></figure>

<h2 id="7-缓存"><a href="#7-缓存" class="headerlink" title="7.缓存"></a>7.缓存</h2><p><img src="https://raw.githubusercontent.com/chen-boran/Picture_bed/main/img/image-20211026214739683.png" alt="image-20211026214739683"></p>
<h3 id="7-1-一级缓存"><a href="#7-1-一级缓存" class="headerlink" title="7.1.一级缓存"></a>7.1.一级缓存</h3><ul>
<li><p>一级缓存(local cache), 即本地缓存, 作用域默认为sqlSession。当 Session flush 或 close 后, 该Session 中的所有 Cache 将被清空。</p>
</li>
<li><p>本地缓存不能被关闭, 但可以调用 clearCache() 来清空本地缓存, 或者改变缓存的作用域. </p>
<p>在mybatis3.1之后, 可以配置本地缓存的作用域</p>
</li>
<li><p>在mybatis中，一级缓存默认是开启的，并且一直无法关闭</p>
</li>
</ul>
<p>一级缓存满足条件：</p>
<ul>
<li>1、同一个session中</li>
<li>2、相同的SQL和参数 </li>
</ul>
<h4 id="一级缓存失效"><a href="#一级缓存失效" class="headerlink" title="一级缓存失效"></a>一级缓存失效</h4><ol>
<li>sqlsession不同的情况</li>
<li>同一个sqlsession,查询条件不同,缓存中还没有</li>
<li>两次查询执行了增删改，导致缓存内容失效</li>
<li>手动清除了一级缓存</li>
</ol>
<h3 id="7-2-二级缓存"><a href="#7-2-二级缓存" class="headerlink" title="7.2.二级缓存"></a>7.2.二级缓存</h3><p>也就是全局缓存，：基于namespace级别的缓存：</p>
<p>二级缓存：  一个namespace对应一个二级缓存：</p>
<p>工作机制：</p>
<ul>
<li><p>1、一个会话，查询一条数据，这个数据就会被放在当前会话的一级缓存中；</p>
</li>
<li><p>2、如果会话关闭；一级缓存中的数据会被保存到二级缓存中；新的会话查询信息，就可以参照二级缓存中的内容；</p>
</li>
<li><p>3、sqlSession===EmployeeMapper==&gt;EmployeeDepartmentMapper===&gt;Department</p>
<p>​        不同namespace查出的数据会放在自己对应的缓存中（map）</p>
<p>​        效果：数据会从二级缓存中获取</p>
<p>​        查出的数据都会被默认先放在一级缓存中。</p>
<p>​        只有<strong>会话提交或者关闭</strong>以后，一级缓存中的数据才会转移到二级缓存中</p>
</li>
</ul>
<p> 使用：</p>
<ul>
<li><p>```</p>
<pre><code>1）、开启全局二级缓存配置：&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;

2）mapper.xml中配置使用二级缓存：      
    &lt;cache&gt;        &lt;/cache&gt;

3）我们的POJO需要实现序列化接口
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  缓存有关的设置&#x2F;属性：</span><br><span class="line"></span><br><span class="line">  1）cacheEnabled&#x3D;true：false：关闭缓存（二级缓存关闭）(一级缓存一直可用的)</span><br><span class="line"></span><br><span class="line">  2）每个select标签都有useCache&#x3D;&quot;true&quot;：</span><br><span class="line"></span><br><span class="line">  ​				false：不使用缓存（一级缓存依然使用，二级缓存不使用）</span><br><span class="line"></span><br><span class="line">  3）每个增删改标签的：flushCache&#x3D;&quot;true&quot;：（一级二级都会清除）</span><br><span class="line"></span><br><span class="line">  ​	  		  增删改执行完成后就会清除缓存；</span><br><span class="line"></span><br><span class="line">  ​				测试：flushCache&#x3D;&quot;true&quot;：一级缓存就清空了；二级也会被清除；</span><br><span class="line"></span><br><span class="line">  ​				查询标签：flushCache&#x3D;&quot;false&quot;：如果flushCache&#x3D;true;每次查询之后都会清				空缓存；缓存是没有被使用的；</span><br><span class="line"></span><br><span class="line">  4）、sqlSession.clearCache();只是清除当前session的一级缓存；</span><br><span class="line"></span><br><span class="line">  5）、localCacheScope：本地缓存作用域：（一级缓存SESSION）；当前会话的所有数			据保存在会话缓存中；</span><br><span class="line"></span><br><span class="line">  ​			STATEMENT：可以禁用一级缓存；       </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 8.Spring 集成Mybatis</span><br><span class="line"></span><br><span class="line">### 8.1引入spring和Mybatis相关依赖</span><br><span class="line"></span><br><span class="line">pom.xml</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<!--数据库连接池-->
<dependency>
  <groupId>com.alibaba</groupId>
  <artifactId>druid</artifactId>
  <version>1.1.8</version>
</dependency>
<dependency>
  <groupId>org.mybatis</groupId>
  <artifactId>mybatis-spring</artifactId>
  <version>1.2.2</version>
</dependency>
<dependency>
  <groupId>org.springframework</groupId>
  <artifactId>spring-jdbc</artifactId>
  <version>4.1.3.RELEASE</version>
</dependency>
<!--spring集成Junit测试-->
<dependency>
  <groupId>org.springframework</groupId>
  <artifactId>spring-test</artifactId>
  <version>4.1.3.RELEASE</version>
  <scope>test</scope>
</dependency>
<!--spring容器-->
<dependency>
  <groupId>org.springframework</groupId>
  <artifactId>spring-context</artifactId>
  <version>4.1.3.RELEASE</version>
</dependency>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 8.2配置spring配置文件</span><br><span class="line"></span><br><span class="line">applicationContext-dao.xml</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:context="http://www.springframework.org/schema/context" xmlns:p="http://www.springframework.org/schema/p"
     xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
 http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd
 http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd
 http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd">

  <!-- 加载配置文件 -->
<p>  &lt;context:property-placeholder location=”classpath:properties/*.properties”/&gt;</p>
  <!-- 数据库连接池 -->
<p>  &lt;bean id=”dataSource” class=”com.alibaba.druid.pool.DruidDataSource”</p>
<pre><code>    destroy-method=&quot;close&quot;&gt;
  &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;
  &lt;property name=&quot;url&quot;
            value=&quot;jdbc:mysql://$&#123;jdbc.host&#125;:3306/$&#123;jdbc.database&#125;?useUnicode=true&amp;amp;characterEncoding=utf-8&amp;amp;zeroDateTimeBehavior=convertToNull&quot;/&gt;
  &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.userName&#125;&quot;/&gt;
  &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.passWord&#125;&quot;/&gt;
  &lt;!-- 初始化连接大小 --&gt;
  &lt;property name=&quot;initialSize&quot; value=&quot;$&#123;jdbc.initialSize&#125;&quot;&gt;&lt;/property&gt;
  &lt;!-- 连接池最大数据库连接数  0 为没有限制 --&gt;
  &lt;property name=&quot;maxActive&quot; value=&quot;$&#123;jdbc.maxActive&#125;&quot;&gt;&lt;/property&gt;
  &lt;!-- 连接池最大的空闲连接数，这里取值为20，表示即使没有数据库连接时依然可以保持20空闲的连接，而不被清除，随时处于待命状态 0 为没有限制 --&gt;
  &lt;property name=&quot;maxIdle&quot; value=&quot;$&#123;jdbc.maxIdle&#125;&quot;&gt;&lt;/property&gt;
  &lt;!-- 连接池最小空闲 --&gt;
  &lt;property name=&quot;minIdle&quot; value=&quot;$&#123;jdbc.minIdle&#125;&quot;&gt;&lt;/property&gt;
  &lt;!--最大建立连接等待时间。如果超过此时间将接到异常。设为-1表示无限制--&gt;
  &lt;property name=&quot;maxWait&quot; value=&quot;$&#123;jdbc.maxWait&#125;&quot;&gt;&lt;/property&gt;
</code></pre>
  </bean>

  <!-- spring和MyBatis完美整合 -->
  <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
      <property name="dataSource" ref="dataSource"/>
      <!-- 自动扫描mapping.xml文件 -->
      <property name="mapperLocations" value="classpath:mappers/*.xml"></property>
      <!--如果mybatis-config.xml没有特殊配置也可以不需要下面的配置-->
      <property name="configLocation" value="classpath:mybatis-config.xml" />
  </bean>

  <!-- DAO接口所在包名，Spring会自动查找其下的类 -->
  <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
      <property name="basePackage" value="com.zpc.mybatis.dao"/>
      <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"></property>
  </bean>

  <!-- (事务管理)transaction manager -->
<p>  &lt;bean id=”transactionManager”</p>
<pre><code>    class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
</code></pre>
  </bean>
</beans>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">db.properties</span><br><span class="line"></span><br></pre></td></tr></table></figure>
jdbc.driver=com.mysql.jdbc.Driver
jdbc.host=localhost
jdbc.database=ssmdemo
jdbc.userName=root
jdbc.passWord=123456
jdbc.initialSize=0
jdbc.maxActive=20
jdbc.maxIdle=20
jdbc.minIdle=1
jdbc.maxWait=1000
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">由于applicationContext-dao.xml中配置了Mapper接口扫描，所以删除mybatis-config.xml中的配置，否则报已映射错误：</span><br><span class="line">Caused by: org.apache.ibatis.builder.BuilderException: Error parsing Mapper XML. Cause: java.lang.IllegalArgumentException: Mapped Statements collection already contains value for MyMapper.selectUser</span><br><span class="line">删除mybatis-config.xml中的映射配置：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<!--<mappers>-->
  <!--<mapper resource="mappers/MyMapper.xml"/>-->
  <!--<mapper resource="mappers/UserDaoMapper.xml"/>-->
  <!--<mapper resource="mappers/UserMapper.xml"/>-->
  <!--<mapper resource="mappers/OrderMapper.xml"/>-->
<!--</mappers>-->
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">或者在构建sqlSessionFactory时不配置mybatis-config.xml也行：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<!-- spring和MyBatis完美整合 -->
<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
  <property name="dataSource" ref="dataSource"/>
  <!-- 自动扫描mapping.xml文件 -->
  <property name="mapperLocations" value="classpath:mappers/*.xml"></property>
  <!--如果mybatis-config.xml没有特殊配置也可以不需要下面的配置-->
  <!--<property name="configLocation" value="classpath:mybatis-config.xml" />-->
</bean>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 8.3 测试</span><br><span class="line"></span><br><span class="line">UserMapperSpringTest.java</span><br><span class="line"></span><br></pre></td></tr></table></figure>
import com.zpc.mybatis.dao.UserMapper;
import com.zpc.mybatis.pojo.User;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import java.io.InputStream;
import java.util.Date;
import java.util.List;</li>
</ul>
<p>//目标：测试一下spring的bean的某些功能<br>@RunWith(SpringJUnit4ClassRunner.class)//junit整合spring的测试//立马开启了spring的注解<br>@ContextConfiguration(locations=”classpath:spring/applicationContext-*.xml”)//加载核心配置文件，自动构建spring容器<br>public class UserMapperSpringTest {</p>
<pre><code>@Autowired
private UserMapper userMapper;

@Test
public void testQueryUserByTableName() &#123;
    List&lt;User&gt; userList = this.userMapper.queryUserByTableName(&quot;tb_user&quot;);
    for (User user : userList) &#123;
        System.out.println(user);
    &#125;
&#125;

@Test
public void testLogin() &#123;
    System.out.println(this.userMapper.login(&quot;hj&quot;, &quot;123456&quot;));
&#125;

@Test
public void testQueryUserById() &#123;
    System.out.println(this.userMapper.queryUserById(&quot;1&quot;));
    User user = new User();
    user.setName(&quot;美女&quot;);
    user.setId(&quot;1&quot;);
    userMapper.updateUser(user);

    System.out.println(this.userMapper.queryUserById(&quot;1&quot;));
&#125;

@Test
public void testQueryUserAll() &#123;
    List&lt;User&gt; userList = this.userMapper.queryUserAll();
    for (User user : userList) &#123;
        System.out.println(user);
    &#125;
&#125;

@Test
public void testInsertUser() &#123;
    User user = new User();
    user.setAge(20);
    user.setBirthday(new Date());
    user.setName(&quot;大神&quot;);
    user.setPassword(&quot;123456&quot;);
    user.setSex(2);
    user.setUserName(&quot;bigGod222&quot;);
    this.userMapper.insertUser(user);
    System.out.println(user.getId());
&#125;

@Test
public void testUpdateUser() &#123;
    User user = new User();
    user.setBirthday(new Date());
    user.setName(&quot;静静&quot;);
    user.setPassword(&quot;123456&quot;);
    user.setSex(0);
    user.setUserName(&quot;Jinjin&quot;);
    user.setId(&quot;1&quot;);
    this.userMapper.updateUser(user);
&#125;

@Test
public void testDeleteUserById() &#123;
    this.userMapper.deleteUserById(&quot;1&quot;);
&#125;

@Test
public void testqueryUserList() &#123;
    List&lt;User&gt; users = this.userMapper.queryUserList(null);
    for (User user : users) &#123;
        System.out.println(user);
    &#125;
&#125;

@Test
public void queryUserListByNameAndAge() throws Exception &#123;
    List&lt;User&gt; users = this.userMapper.queryUserListByNameAndAge(&quot;鹏程&quot;, 20);
    for (User user : users) &#123;
        System.out.println(user);
    &#125;
&#125;

@Test
public void queryUserListByNameOrAge() throws Exception &#123;
    List&lt;User&gt; users = this.userMapper.queryUserListByNameOrAge(null, 16);
    for (User user : users) &#123;
        System.out.println(user);
    &#125;
&#125;

@Test
public void queryUserListByIds() throws Exception &#123;
    List&lt;User&gt; users = this.userMapper.queryUserListByIds(new String[]&#123;&quot;5&quot;, &quot;2&quot;&#125;);
    for (User user : users) &#123;
        System.out.println(user);
    &#125;
&#125;
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">目录结构：</span><br><span class="line"></span><br><span class="line">![img](https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;chen-boran&#x2F;Picture_bed&#x2F;main&#x2F;img&#x2F;1456626-20190327213559514-141765959.png)</span><br><span class="line"></span><br><span class="line">## 9.SpringBoot 集成Mybatis</span><br><span class="line"></span><br><span class="line">请参见博客：https:&#x2F;&#x2F;blog.csdn.net&#x2F;hellozpc&#x2F;article&#x2F;details&#x2F;82531834</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">###  </span><br><span class="line"></span><br><span class="line">## 10. Mabitis 逆向工程</span><br><span class="line"></span><br><span class="line">**MyBatis Generator：** </span><br><span class="line"></span><br><span class="line"> 一个专门为MyBatis框架使用者定制的代码生成器，快速的根据表生成对应的映射文件，接口，以及bean类。支持基本的增删改查，以及QBC风格的条件查询。但是表连接、存储过程等这些复杂sql的定义需要我们手工编写。</span><br><span class="line"></span><br><span class="line">• 官方文档地址</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;www.mybatis.org&#x2F;generator&#x2F; </span><br><span class="line"></span><br><span class="line">• 官方工程地址</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;mybatis&#x2F;generator&#x2F;releases</span><br><span class="line"></span><br><span class="line">**使用**：创建数据库文件</span><br><span class="line"></span><br><span class="line">倒入逆向工程jar包     mybatis-generator-core-1.3.2.jar</span><br><span class="line"></span><br><span class="line">使用步骤：</span><br><span class="line"></span><br><span class="line">1）编写MBG的配置文件（重要几处配置）</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>1）jdbcConnection配置数据库连接信息</p>
<p>2）javaModelGenerator配置javaBean的生成策略</p>
<p>3）sqlMapGenerator 配置sql映射文件生成策略</p>
<p>4）javaClientGenerator配置Mapper接口的生成策略</p>
<p>5）table 配置要逆向解析的数据表</p>
<p>tableName：表名</p>
<p>domainObjectName：对应的javaBean名 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  2）运行代码生成器生成代码</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">## 11.Mybatis工作原理</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>步骤：</p>
<ul>
<li> 1、根据配置文件（全局，sql映射）初始化出Configuration对象</li>
<li> 2、创建一个DefaultSqlSession对象，</li>
<li><pre><code>他里面包含Configuration以及
</code></pre>
</li>
<li><pre><code>Executor（根据全局配置文件中的defaultExecutorType创建出对应的Executor）
</code></pre>
</li>
<li> 3、DefaultSqlSession.getMapper（）：拿到Mapper接口对应的MapperProxy；</li>
<li> 4、MapperProxy里面有（DefaultSqlSession）；</li>
<li> 5、执行增删改查方法：</li>
<li><pre><code>    1）、调用DefaultSqlSession的增删改查（Executor）；
</code></pre>
</li>
<li><pre><code>    2）、会创建一个StatementHandler对象。
</code></pre>
</li>
<li><pre><code>       （同时也会创建出ParameterHandler和ResultSetHandler）
</code></pre>
</li>
<li><pre><code>    3）、调用StatementHandler预编译参数以及设置参数值;
</code></pre>
</li>
<li><pre><code>       使用ParameterHandler来给sql设置参数
</code></pre>
</li>
<li><pre><code>    4）、调用StatementHandler的增删改查方法；
</code></pre>
</li>
<li><pre><code>    5）、ResultSetHandler封装结果
</code></pre>
</li>
<li> 注意：</li>
<li><pre><code> 四大对象每个创建的时候都有一个                         interceptorChain.pluginAll(parameterHandler);
</code></pre>
</li>
<li>```</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">chen-boran</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/10/28/Mybatis/">http://example.com/2021/10/28/Mybatis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://ae01.alicdn.com/kf/U36fdd5af2ca24a5c8cf8bd7e3195e13bx.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/10/31/Zookeeper/"><img class="prev-cover" src="https://ae01.alicdn.com/kf/Ue5889eaf11594a4aabca090c5d5060798.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Zookeeper</div></div></a></div><div class="next-post pull-right"><a href="/2021/10/28/picGo-github%E5%9B%BE%E5%BA%8A%E5%88%9B%E5%BB%BA%E8%B8%A9%E5%9D%91/"><img class="next-cover" src="https://ae01.alicdn.com/kf/U36fdd5af2ca24a5c8cf8bd7e3195e13bx.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">picGo+github图床创建踩坑</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/favicon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">chen-boran</div><div class="author-info__description">I want to roll the sky desperately!</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">26</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/chen_boran"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-MyBatis%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">1.MyBatis简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Mybaits%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">2.Mybaits整体架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%B5%81%E7%A8%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">3.</span> <span class="toc-text">3.流程概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96%EF%BC%88pom-xml%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">3.1.引入依赖（pom.xml）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%88mybatis-config-xml%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">3.2.全局配置文件（mybatis-config.xml）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E9%85%8D%E7%BD%AEMap-xml"><span class="toc-number">3.3.</span> <span class="toc-text">3.3.配置Map.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E4%BF%AE%E6%94%B9%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%88mybatis-config-xml%EF%BC%89"><span class="toc-number">3.4.</span> <span class="toc-text">3.4.修改全局配置文件（mybatis-config.xml）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E6%9E%84%E5%BB%BAsqlSessionFactory%EF%BC%88MybatisTest-java%EF%BC%89"><span class="toc-number">3.5.</span> <span class="toc-text">3.5.构建sqlSessionFactory（MybatisTest.java）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E5%BC%80%E5%90%AFsqlSession%E4%BC%9A%E8%AF%9D%EF%BC%8C%E6%89%A7%E8%A1%8Csql%EF%BC%88MybatisTest-java%EF%BC%89"><span class="toc-number">3.6.</span> <span class="toc-text">3.6.开启sqlSession会话，执行sql（MybatisTest.java）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text">日志配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.2.</span> <span class="toc-text">MyBatis使用步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-mybatis-config-xml%E8%AF%A6%E8%A7%A3"><span class="toc-number">5.</span> <span class="toc-text">4.mybatis-config.xml详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-properties%E5%B1%9E%E6%80%A7%E8%AF%BB%E5%8F%96%E5%A4%96%E9%83%A8%E8%B5%84%E6%BA%90"><span class="toc-number">5.1.</span> <span class="toc-text">4.1.properties属性读取外部资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-typeHandlers%EF%BC%88%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%89"><span class="toc-number">5.2.</span> <span class="toc-text">4.4.typeHandlers（类型处理器）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-plugins%EF%BC%88%E6%8F%92%E4%BB%B6%EF%BC%89%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">5.3.</span> <span class="toc-text">4.5.plugins（插件）拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-environments-%E7%8E%AF%E5%A2%83"><span class="toc-number">5.4.</span> <span class="toc-text">4.6.environments(环境)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-mappers"><span class="toc-number">5.5.</span> <span class="toc-text">4.7.mappers</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Mapper-XML%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">6.</span> <span class="toc-text">5.Mapper XML文件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-CRUD%E6%A0%87%E7%AD%BE"><span class="toc-number">6.1.</span> <span class="toc-text">5.1.CRUD标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-select"><span class="toc-number">6.1.1.</span> <span class="toc-text">5.1.1.select</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-insert"><span class="toc-number">6.1.2.</span> <span class="toc-text">5.1.2.insert</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3-update"><span class="toc-number">6.1.3.</span> <span class="toc-text">5.1.3.update</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-4-delete"><span class="toc-number">6.1.4.</span> <span class="toc-text">5.1.4.delete</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%92%8C"><span class="toc-number">6.2.</span> <span class="toc-text">5.2.#{}和${}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E3%80%81-%E5%8C%BA%E5%88%AB"><span class="toc-number">6.3.</span> <span class="toc-text">5.3.#、$区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-resultMap"><span class="toc-number">6.4.</span> <span class="toc-text">5.4.resultMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-sql%E7%89%87%E6%AE%B5"><span class="toc-number">6.5.</span> <span class="toc-text">5.5.sql片段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%8A%A8%E6%80%81sql"><span class="toc-number">7.</span> <span class="toc-text">6.动态sql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#if"><span class="toc-number">7.1.</span> <span class="toc-text">if</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#choose%E3%80%81when%E3%80%81otherwise"><span class="toc-number">7.2.</span> <span class="toc-text">choose、when、otherwise</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trim%E3%80%81where%E3%80%81set"><span class="toc-number">7.3.</span> <span class="toc-text">trim、where、set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#foreach"><span class="toc-number">7.4.</span> <span class="toc-text">foreach</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#script"><span class="toc-number">7.5.</span> <span class="toc-text">script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bind"><span class="toc-number">7.6.</span> <span class="toc-text">bind</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81"><span class="toc-number">7.7.</span> <span class="toc-text">多数据库支持</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E7%BC%93%E5%AD%98"><span class="toc-number">8.</span> <span class="toc-text">7.缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">8.1.</span> <span class="toc-text">7.1.一级缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88"><span class="toc-number">8.1.1.</span> <span class="toc-text">一级缓存失效</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">8.2.</span> <span class="toc-text">7.2.二级缓存</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/11/01/%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/" title="网络信息安全"><img src="https://ae01.alicdn.com/kf/U36fdd5af2ca24a5c8cf8bd7e3195e13bx.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网络信息安全"/></a><div class="content"><a class="title" href="/2021/11/01/%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/" title="网络信息安全">网络信息安全</a><time datetime="2021-11-01T13:24:39.000Z" title="Created 2021-11-01 21:24:39">2021-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/31/Zookeeper/" title="Zookeeper"><img src="https://ae01.alicdn.com/kf/Ue5889eaf11594a4aabca090c5d5060798.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Zookeeper"/></a><div class="content"><a class="title" href="/2021/10/31/Zookeeper/" title="Zookeeper">Zookeeper</a><time datetime="2021-10-31T13:16:49.000Z" title="Created 2021-10-31 21:16:49">2021-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/28/Mybatis/" title="Mybatis"><img src="https://ae01.alicdn.com/kf/U36fdd5af2ca24a5c8cf8bd7e3195e13bx.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mybatis"/></a><div class="content"><a class="title" href="/2021/10/28/Mybatis/" title="Mybatis">Mybatis</a><time datetime="2021-10-28T13:47:32.000Z" title="Created 2021-10-28 21:47:32">2021-10-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/28/picGo-github%E5%9B%BE%E5%BA%8A%E5%88%9B%E5%BB%BA%E8%B8%A9%E5%9D%91/" title="picGo+github图床创建踩坑"><img src="https://ae01.alicdn.com/kf/U36fdd5af2ca24a5c8cf8bd7e3195e13bx.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="picGo+github图床创建踩坑"/></a><div class="content"><a class="title" href="/2021/10/28/picGo-github%E5%9B%BE%E5%BA%8A%E5%88%9B%E5%BB%BA%E8%B8%A9%E5%9D%91/" title="picGo+github图床创建踩坑">picGo+github图床创建踩坑</a><time datetime="2021-10-28T13:22:41.000Z" title="Created 2021-10-28 21:22:41">2021-10-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/28/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" title="多线程"><img src="https://ae01.alicdn.com/kf/U36fdd5af2ca24a5c8cf8bd7e3195e13bx.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="多线程"/></a><div class="content"><a class="title" href="/2021/10/28/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" title="多线程">多线程</a><time datetime="2021-10-28T13:21:13.000Z" title="Created 2021-10-28 21:21:13">2021-10-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By chen-boran</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>